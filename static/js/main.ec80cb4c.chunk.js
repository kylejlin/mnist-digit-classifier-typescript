(this["webpackJsonpmnist-digit-classifier-typescript"]=this["webpackJsonpmnist-digit-classifier-typescript"]||[]).push([[0],{16:function(e,t,n){e.exports=function(){return new Worker(n.p+"9f33208249dc31c5c687.worker.js")}},17:function(e,t,n){e.exports=function(){return new Worker(n.p+"6f63fe1657b9133450d1.worker.js")}},21:function(e,t,n){e.exports=n(35)},26:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(15),o=n.n(i),s=n(6),u=n(1),l=n(5),c=n(3),h=n(9),m=n(20),p=n(18),f=n(2),d=(n(26),n(19)),g=n(8),v=n.n(g),w=function(){function e(t,n,a){Object(l.a)(this,e),this.rows=void 0,this.columns=void 0,this.data=void 0,this.rows=t,this.columns=n,this.data=a instanceof Float64Array?a:Float64Array.from(a)}return Object(c.a)(e,null,[{key:"randomUniform",value:function(t,n){for(var a=t*n,r=new Float64Array(a),i=0;i<a;i++)r[i]=2*Math.random()-1;return new e(t,n,r)}},{key:"fromEntryInitializer",value:function(t,n,a){return new e(t,n,new Float64Array(t*n).map(a))}},{key:"zeros",value:function(t,n){return new e(t,n,new Float64Array(t*n))}},{key:"fromRows",value:function(t){var n=t[0].length;if(t.some((function(e){return e.length!==n})))throw new Error("Cannot create a matrix from a jagged array: "+JSON.stringify(t));return new e(t.length,n,t.flat())}},{key:"columnVector",value:function(t){return new e(t.length,1,t)}},{key:"fromRowMajorOrderEntries",value:function(t,n,a){if(a.length!==t*n)throw new Error("Expected "+t*n+" entries but instead got "+a.length+".");return new e(t,n,a)}}]),Object(c.a)(e,[{key:"clone",value:function(){return new e(this.rows,this.columns,this.data.slice())}},{key:"mutMultiplyScalar",value:function(e){for(var t=this.data.length,n=0;n<t;n++)this.data[n]*=e;return this}},{key:"multiplyScalarInto",value:function(e,t){if(this.rows!==t.rows||this.columns!==t.columns)throw new Error("Cannot multiply a scalar "+e+" by a "+this.rows+"x"+this.columns+" matrix into a "+t.rows+"x"+t.columns+" matrix. The out matrix must have the same dimensions as this matrix.");for(var n=this.data,a=t.data,r=a.length,i=0;i<r;i++)a[i]=e*n[i];return t}},{key:"mutAdd",value:function(e){if(e.rows!==this.rows||e.columns!==this.columns)throw new TypeError("Cannot add a "+this.rows+"x"+this.columns+" to a "+e.rows+"x"+e.columns+" matrix.");for(var t=this.data.length,n=0;n<t;n++)this.data[n]+=e.data[n];return this}},{key:"mutSubtract",value:function(e){if(e.rows!==this.rows||e.columns!==this.columns)throw new TypeError("Cannot add a "+this.rows+"x"+this.columns+" to a "+e.rows+"x"+e.columns+" matrix.");for(var t=this.data.length,n=0;n<t;n++)this.data[n]-=e.data[n];return this}},{key:"immutSubtract",value:function(e){return this.subtractInto(e,this.clone())}},{key:"subtractInto",value:function(e,t){if(e.rows!==this.rows||e.columns!==this.columns)throw new TypeError("Cannot add a "+this.rows+"x"+this.columns+" matrix to a "+e.rows+"x"+e.columns+" matrix.");for(var n=this.data,a=e.data,r=t.data,i=r.length,o=0;o<i;o++)r[o]=n[o]-a[o];return t}},{key:"immutMultiply",value:function(t){return this.multiplyInto(t,e.zeros(this.rows,t.columns))}},{key:"multiplyInto",value:function(e,t){if(this.columns!==e.rows)throw new TypeError("Cannot multiply a "+this.rows+"x"+this.columns+" matrix with a "+e.rows+"x"+e.columns+" matrix.");if(this.rows!==t.rows||e.columns!==t.columns)throw new TypeError("Cannot multiply a "+this.rows+"x"+this.columns+" matrix with a "+e.rows+"x"+e.columns+" matrix into a "+t.rows+"x"+t.columns+" matrix.");for(var n=this.data,a=e.data,r=t.data,i=this.rows,o=e.columns,s=this.columns,u=t.columns,l=0;l<i;l++)for(var c=0;c<o;c++){for(var h=0,m=0;m<s;m++)h+=n[l*s+m]*a[m*o+c];r[l*u+c]=h}return t}},{key:"mutHadamard",value:function(e){if(e.rows!==this.rows||e.columns!==this.columns)throw new TypeError("Cannot take the Hadamard product of a "+this.rows+"x"+this.columns+" matrix and a "+e.rows+"x"+e.columns+" matrix.");for(var t=this.data.length,n=0;n<t;n++)this.data[n]*=e.data[n];return this}},{key:"immutTranspose",value:function(){return this.transposeInto(new e(this.columns,this.rows,new Float64Array(this.data.length)))}},{key:"transposeInto",value:function(e){if(this.rows!==e.columns||this.columns!==e.rows)throw new Error("Cannot transpose a "+this.rows+"x"+this.columns+" matrix into a "+e.rows+"x"+e.columns+" matrix.");for(var t=this.data,n=this.rows,a=this.columns,r=e.data,i=e.columns,o=0;o<n;o++)for(var s=0;s<a;s++)r[s*i+o]=t[o*a+s];return e}},{key:"rowMajorOrderEntries",value:function(){return this.data}},{key:"immutApplyElementwise",value:function(e){return this.applyElementwiseInto(e,this.clone())}},{key:"applyElementwiseInto",value:function(e,t){if(this.rows!==t.rows||this.columns!==t.columns)throw new TypeError("Cannot apply "+e.name+" elementwise on a "+this.rows+"x"+this.columns+" matrix into a "+t.rows+"x"+t.columns+" matrix. Matrices must have the same dimensions.");for(var n=this.data,a=t.data,r=a.length,i=0;i<r;i++)a[i]=e(n[i]);return t}},{key:"copyInto",value:function(e){if(this.rows!==e.rows||this.columns!==e.columns)throw new Error("Cannot copy a "+this.rows+"x"+this.columns+" matrix into a "+e.rows+"x"+e.columns+" matrix.");for(var t=this.data,n=e.data,a=n.length,r=0;r<a;r++)n[r]=t[r];return e}},{key:"setToZero",value:function(){for(var e=this.data,t=e.length,n=0;n<t;n++)e[n]=0}},{key:"print",value:function(e){for(var t=Array.from(this.rowMajorOrderEntries()).map((function(t){return t.toFixed(e)})),n=t.map((function(e){return e.length})),a=Math.max.apply(Math,Object(s.a)(n)),r="-".repeat(this.columns*(a+" | ".length)-" | ".length),i=r+"\n",o=0;o<this.rows;o++){for(var u=0;u<this.columns;u++)i+=y(t[o*this.columns+u],a," ")+" | ";i=i.slice(0,-" | ".length),i+="\n"}return i+=r}}]),e}();function y(e,t,n){var a=t-e.length;return a<=0?e:n.repeat(a)+e}var C={offset:0,requiredValue:2051},I={offset:4},k={offset:8},b={offset:12},S={offset:0,requiredValue:2049},x={offset:4};function E(e,t){var n=function(e){var t=new Uint8Array(e);!function(e){var t=M(e,C.offset),n=C.requiredValue;if(t!==n)throw new Error("The first 4 bytes of an idx3 file must be 0x"+n.toString(16)+", but the first 4 bytes of the provided file were 0x"+t.toString(16))}(t);var n=M(t,I.offset),a=M(t,k.offset),r=M(t,b.offset),i=a*r,o=0,s=new Array(n),u=b.offset+4;for(;o<n;){for(var l=new Array(i),c=0;c<i;c++)l[c]=t[u+o*i+c]/255;s[o]={rows:a,columns:r,matrix:w.columnVector(l)},o++}return s}(e),a=function(e){var t=new Uint8Array(e);!function(e){var t=M(e,S.offset),n=S.requiredValue;if(t!==n)throw new Error("The first 4 bytes of an idx1 file must be 0x"+n.toString(16)+", but the first 4 bytes of the provided file were 0x"+t.toString(16))}(t);for(var n=M(t,x.offset),a=new Array(n),r=x.offset+4,i=0;i<n;i++)a[i]=t[r+i];return a}(t);if(n.length!==a.length)throw new Error("There are "+n.length+" images, but "+a.length+" labels. There must be the same amount of images and labels.");for(var r=new Array(n.length),i=0;i<n.length;i++){var o=n[i],s=o.rows,u=o.columns,l=o.matrix;r[i]={rows:s,columns:u,inputs:l,label:a[i]}}return r}function M(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function T(e){var t=new Array(10).fill(0);t[e.label]=1;var n=w.columnVector(t);return{rows:e.rows,columns:e.columns,inputs:e.inputs,outputs:n}}var R=self.location,V=v.a.resolve(R.href,"./assets/train60k-images-idx3-ubyte"),z=v.a.resolve(R.href,"./assets/train60k-labels-idx1-ubyte"),O=v.a.resolve(R.href,"./assets/test10k-images-idx3-ubyte"),A=v.a.resolve(R.href,"./assets/test10k-labels-idx1-ubyte"),L=B(V),j=B(z),N=B(O),P=B(A);function B(e){return fetch(e).then((function(t){return 200<=t.status&&t.status<=299?t.arrayBuffer():function(e){var t=e.status,n=e.statusText;return e.text().then((function(e){return t+" ("+n+"): "+e}))}(t).then((function(t){return Promise.reject(new Error("Tried to fetch "+e+" but got the following error: "+t))}))}))}var G,_=Promise.all([L,j,N,P]).then((function(e){var t=Object(d.a)(e,4),n=t[0],a=t[1],r=t[2],i=t[3];return{training:E(n,a).map(T),test:E(r,i)}}));!function(e){e.Uniform="Uniform",e.LargeGaussian="LargeGaussian",e.SmallGaussian="SmallGaussian"}(G||(G={}));var q=n(10);function D(){return 2*Math.random()-1}function U(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,a=0;0===n;)n=Math.random();for(;0===a;)a=Math.random();var r=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*a);return t*r+e}function W(e,t){!function(e){for(var t=0;t<512;t++)for(var n=e.length-1;n>=1;n--){var a=(i=n+1,Math.floor(Math.random()*i)),r=e[n];e[n]=e[a],e[a]=r}var i}(e);for(var n=[],a=0;a<e.length;a+=t)n.push(e.slice(a,a+t));return n}function H(e){for(var t=0,n=e[t],a=1;a<e.length;a++){var r=e[a];r>n&&(n=r,t=a)}return t}var F=function(){function e(t,n,a){Object(l.a)(this,e),this.numberOfLayers=void 0,this.weights=void 0,this.biases=void 0,this.weightVelocities=void 0,this.biasVelocities=void 0,this.log=void 0,this.temp_totalWeightGradients=void 0,this.temp_totalBiasGradients=void 0,this.temp_weightedSums=void 0,this.temp_activations=void 0,this.temp_errors=void 0,this.temp_weightGradients=void 0,this.temp_biasGradients=void 0,this.temp_transposedActivations=void 0,this.temp_weightCosts=void 0,this.temp_transposedWeights=void 0,this.temp_sigmaPrimeOfWeightedSums=void 0,this.layerSizes=void 0;for(var r=[t[1].columns],i=1;i<t.length;i++)r.push(t[i].rows);this.layerSizes=r,this.numberOfLayers=r.length,this.weights=t,this.biases=n,this.weightVelocities=J(t),this.biasVelocities=J(n),this.log=a||function(){},this.temp_totalWeightGradients=J(t),this.temp_totalBiasGradients=J(n);for(var o=[],s=[w.zeros(t[1].columns,1)],u=1;u<this.numberOfLayers;u++)o[u]=w.zeros(t[u].rows,1),s[u]=w.zeros(t[u].rows,1);this.temp_weightedSums=o,this.temp_activations=s,this.temp_errors=J(this.temp_weightedSums),this.temp_weightGradients=J(t),this.temp_biasGradients=J(n);for(var c=this.temp_activations,h=new Array(c.length),m=0;m<c.length;m++)h[m]=w.zeros(c[m].columns,c[m].rows);this.temp_transposedActivations=h,this.temp_weightCosts=J(this.temp_weightGradients);for(var p=this.weights,f=new Array(p.length),d=1;d<p.length;d++)f[d]=w.zeros(p[d].columns,p[d].rows);this.temp_transposedWeights=f,this.temp_sigmaPrimeOfWeightedSums=J(this.temp_weightedSums)}return Object(c.a)(e,null,[{key:"fromWeightsAndBiases",value:function(t,n){return new e(t,n)}},{key:"fromLayerSizes",value:function(t,n,a){for(var r=t.length,i=new Array(r),o=new Array(r),s=1;s<r;s++){var u=s-1,l=t[s],c=t[u];i[s]=w.zeros(l,c),o[s]=w.zeros(l,1)}return function(e,t){for(var n=function(n){var a=t[n],r=function(){switch(e){case G.Uniform:return D;case G.LargeGaussian:return function(){return U(0,1)};case G.SmallGaussian:return function(){return U(0,1/Math.sqrt(a.columns))}}}();a.applyElementwiseInto(r,a)},a=1;a<t.length;a++)n(a)}(n,i),new e(i,o,a)}}]),Object(c.a)(e,[{key:"stochasticGradientDescent",value:function(e,t,n){for(var a=t.batchSize,r=t.epochs,i=t.learningRate,o=t.momentumCoefficient,s=e.length,u=0;u<r;u++){var l,c=W(e,a),h=Object(q.a)(c);try{for(h.s();!(l=h.n()).done;)for(var m=l.value,p=this.getTotalGradients(m,t.regularizationRate,s),f=p.weightGradients,d=p.biasGradients,g=1;g<this.numberOfLayers;g++)f[g].mutMultiplyScalar(i/m.length),d[g].mutMultiplyScalar(i/m.length),this.weightVelocities[g].mutMultiplyScalar(o).mutSubtract(f[g]),this.biasVelocities[g].mutMultiplyScalar(o).mutSubtract(d[g]),this.weights[g].mutAdd(this.weightVelocities[g]),this.biases[g].mutAdd(this.biasVelocities[g])}catch(w){h.e(w)}finally{h.f()}if(void 0!==n){var v=this.test(n);this.log(v,u)}}}},{key:"getTotalGradients",value:function(e,t,n){var a,r=this.resetTotalGradientTemps(),i=r.weightGradients,o=r.biasGradients,s=Object(q.a)(e);try{for(s.s();!(a=s.n()).done;)for(var u=a.value,l=this.getGradients(u,t,n),c=l.weightGradients,h=l.biasGradients,m=1;m<this.numberOfLayers;m++)i[m].mutAdd(c[m]),o[m].mutAdd(h[m])}catch(p){s.e(p)}finally{s.f()}return{weightGradients:i,biasGradients:o}}},{key:"resetTotalGradientTemps",value:function(){for(var e=this.layerSizes.length,t=this.temp_totalWeightGradients,n=this.temp_totalBiasGradients,a=1;a<e;a++)t[a].setToZero(),n[a].setToZero();return{weightGradients:t,biasGradients:n}}},{key:"getGradients",value:function(e,t,n){var a=this.numberOfLayers,r=this.performForwardPass(e.inputs),i=r.weightedSums,o=r.activations,s=this.temp_errors,u=this.temp_weightGradients,l=this.temp_biasGradients,c=o[this.numberOfLayers-1].subtractInto(e.outputs,s[a-1]);c.multiplyInto(o[a-2].transposeInto(this.temp_transposedActivations[a-2]),u[a-1]).mutAdd(this.weights[a-1].multiplyScalarInto(t/n,this.temp_weightCosts[a-1])),c.copyInto(l[a-1]);for(var h=this.numberOfLayers-2;h>=1;h--){var m=this.weights[h+1].transposeInto(this.temp_transposedWeights[h+1]).multiplyInto(s[h+1],s[h]).mutHadamard(i[h].applyElementwiseInto(X,this.temp_sigmaPrimeOfWeightedSums[h]));m.multiplyInto(o[h-1].transposeInto(this.temp_transposedActivations[h-1]),u[h]).mutAdd(this.weights[h].multiplyScalarInto(t/n,this.temp_weightCosts[h])),m.copyInto(l[h])}return{weightGradients:u,biasGradients:l}}},{key:"performForwardPass",value:function(e){var t=this.temp_weightedSums,n=this.temp_activations;n[0]=e;for(var a=1;a<this.numberOfLayers;a++){var r=a-1;this.weights[a].multiplyInto(n[r],t[a]).mutAdd(this.biases[a]).applyElementwiseInto(Y,n[a])}return{weightedSums:t,activations:n}}},{key:"test",value:function(e){var t,n=0,a=Object(q.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;H(this.performForwardPass(r.inputs).activations[this.numberOfLayers-1].rowMajorOrderEntries())===r.label&&n++}}catch(i){a.e(i)}finally{a.f()}return{correct:n,total:e.length}}},{key:"getWeights",value:function(){return this.weights}},{key:"getBiases",value:function(){return this.biases}}]),e}();function Y(e){return 1/(1+Math.exp(-e))}function X(e){var t=Y(e);return t*(1-t)}function J(e){for(var t=[],n=1;n<e.length;n++){var a=e[n];t[n]=w.zeros(a.rows,a.columns)}return t}var Z,$={fromLayerSizes:function(e,t){return F.fromLayerSizes(e,t)},fromWeightsAndBiases:function(e,t){return F.fromWeightsAndBiases(e,t)}};function K(e){var t=function(e){for(var t=e.getWeights(),n=e.getBiases(),a=0,r=1;r<t.length;r++){var i=t[r],o=i.rows*i.columns;a+=o;var s=n[r],u=s.rows*s.columns;a+=u}for(var l=new Float64Array(a),c=0,h=1;h<t.length;h++){var m=t[h].rowMajorOrderEntries();l.set(m,c),c+=m.length;var p=n[h].rowMajorOrderEntries();l.set(p,c),c+=p.length}return l}(e),n=(1+e.layerSizes.length)*Uint32Array.BYTES_PER_ELEMENT,a=new ArrayBuffer(n+t.length*t.BYTES_PER_ELEMENT),r=new Uint32Array(a,0,n/Uint32Array.BYTES_PER_ELEMENT);r[0]=e.layerSizes.length;for(var i=0;i<e.layerSizes.length;i++)r[1+i]=e.layerSizes[i];return function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=new Uint8Array(e),r=new Uint8Array(t),i=0;i<a.length;i++)r[n+i]=a[i]}(new Float64Array(t).buffer,a,n),a}function Q(e){for(var t=new Uint32Array(e,0,1)[0],n=new Uint32Array(e,4,t),a=new Float64Array(e.slice(Uint32Array.BYTES_PER_ELEMENT*(1+t))),r=[],i=[],o=0,s=1;s<n.length;s++){var u=n[s],l=u,c=n[s-1],h=l*c;r[s]=w.fromRowMajorOrderEntries(l,c,ee(a.subarray(o,o+h))),o+=h;var m=u;i[s]=w.fromRowMajorOrderEntries(m,1,ee(a.subarray(o,o+m))),o+=m}return $.fromWeightsAndBiases(r,i)}function ee(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return t}!function(e){e[e.StartTrainingRequest=0]="StartTrainingRequest",e[e.TrainingEpochCompleteNotification=1]="TrainingEpochCompleteNotification",e[e.TerminateTrainingRequest=2]="TerminateTrainingRequest",e[e.TerminateTrainingResponse=3]="TerminateTrainingResponse",e[e.StartTestingRequest=4]="StartTestingRequest",e[e.TestCompleteNotification=5]="TestCompleteNotification"}(Z||(Z={}));var te,ne,ae,re=n(16),ie=n.n(re).a,oe=n(17),se=n.n(oe).a;function ue(e,t,n){var a=new se;return a.addEventListener("message",(function(e){var t=e.data;if(null!==t&&"object"===typeof t&&"messageType"in t){var r=t;switch(r.messageType){case Z.TrainingEpochCompleteNotification:!function(e){n.onEpochComplete(e.accuracyRate,e.epoch)}(r);break;case Z.TerminateTrainingResponse:!function(e){var t=Q(e.networkBuffer);n.onTerminate(t),a.terminate()}(r);break;default:}}})),{start:function(){var n={messageType:Z.StartTrainingRequest,networkBuffer:K(e),hyperParams:t};a.postMessage(n,[n.networkBuffer])},terminate:function(){var e={messageType:Z.TerminateTrainingRequest};a.postMessage(e)}}}function le(e,t){var n=new ie;return n.addEventListener("message",(function(e){var a=e.data;null!==a&&"object"===typeof a&&"messageType"in a&&function(e){t.onComplete(e.accuracyRate),n.terminate()}(a)})),{start:function(){var t={messageType:Z.StartTestingRequest,networkBuffer:K(e)};n.postMessage(t,[t.networkBuffer])},terminate:function(){n.terminate()}}}!function(e){e[e.CreateNetwork=0]="CreateNetwork",e[e.NetworkMainMenu=1]="NetworkMainMenu",e[e.HyperParameterMenu=2]="HyperParameterMenu",e[e.TrainingInProgress=3]="TrainingInProgress",e[e.Test=4]="Test",e[e.View=5]="View",e[e.Crop=6]="Crop",e[e.MnistLoadingError=7]="MnistLoadingError"}(te||(te={})),function(e){e[e.TopLeftCorner=0]="TopLeftCorner",e[e.TopRightCorner=1]="TopRightCorner",e[e.BottomRightCorner=2]="BottomRightCorner",e[e.BottomLeftCorner=3]="BottomLeftCorner",e[e.EntireSquare=4]="EntireSquare"}(ne||(ne={})),function(e){e.CustomImages="CustomImages",e.NeuralNetwork="NeuralNetwork"}(ae||(ae={}));var ce=function(){var e=localStorage.getItem(ae.CustomImages);if(null===e)return f.option.none();var t=fe(e);if(t.length%785!==0)throw new Error("Cannot decode image bytes because there are "+t.length+" bytes, and that number is not a multiple of 784.");for(var n=t.length/785,a=new Array(n),r=0;r<n;r++){var i=t.subarray(785*r,785*r+784),o=w.columnVector(de(i));a[r]={u8Matrix:o,label:t[785*r+784]}}return f.option.some(a)},he=function(e){for(var t=new Uint8Array(785*e.length),n=0;n<e.length;n++){var a=e[n];t.set(a.u8Matrix.rowMajorOrderEntries(),785*n),t[785*n+784]=a.label}var r=ge(t);localStorage.setItem(ae.CustomImages,r)},me=function(){var e=localStorage.getItem(ae.NeuralNetwork);if(null===e)return f.option.none();var t=Q(fe(e).buffer);return f.option.some(t)},pe=function(e){var t=K(e),n=ge(new Uint8Array(t));localStorage.setItem(ae.NeuralNetwork,n)};function fe(e){for(var t=function(e){var t=new Uint32Array(1);return t[0]=e,t[0]}(e.charCodeAt(0)<<16|e.charCodeAt(1)),n=new Uint8Array(t),a=0;a<t;a++){var r=e.charCodeAt(2+Math.floor(a/2)),i=a%2===0?r>>>8:r;n[a]=i}return n}function de(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return t}function ge(e){for(var t=e.length,n=new Array(Math.ceil(t/2)),a=0;a<e.length;a++){var r=e[a];a%2===0?n[a/2]=r<<8:n[(a-1)/2]|=r}return String.fromCharCode(t>>>16,65535&t)+function(e){try{return String.fromCharCode.apply(String,Object(s.a)(e))}catch(a){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}}(n)}var ve=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).viewImageCanvasRef=void 0,a.customImageInputRef=void 0,a.cropImageCanvasRef=void 0,a.state=me().match({none:function(){return{mnist:f.option.none(),stateType:te.CreateNetwork,hiddenLayerSizeInputValues:["30"],weightInitializationMethod:G.SmallGaussian,previousNetwork:f.option.none()}},some:function(e){return{mnist:f.option.none(),stateType:te.NetworkMainMenu,network:e}}}),a.viewImageCanvasRef=r.a.createRef(),a.customImageInputRef=r.a.createRef(),a.cropImageCanvasRef=r.a.createRef(),a.bindMethods(),window.app=Object(h.a)(a),a}return Object(c.a)(n,[{key:"bindMethods",value:function(){this.onWeightInitializationMethodChange=this.onWeightInitializationMethodChange.bind(this),this.onCreateNetworkClick=this.onCreateNetworkClick.bind(this),this.onTrainClick=this.onTrainClick.bind(this),this.onTestClick=this.onTestClick.bind(this),this.onViewClick=this.onViewClick.bind(this),this.onResetClick=this.onResetClick.bind(this),this.onBatchSizeInputValueChange=this.onBatchSizeInputValueChange.bind(this),this.onEpochsInputValueChange=this.onEpochsInputValueChange.bind(this),this.onLearningRateInputValueChange=this.onLearningRateInputValueChange.bind(this),this.onRegularizationRateInputValueChange=this.onRegularizationRateInputValueChange.bind(this),this.onMomentumCoefficientInputValueChange=this.onMomentumCoefficientInputValueChange.bind(this),this.onStartTrainingClick=this.onStartTrainingClick.bind(this),this.onEpochComplete=this.onEpochComplete.bind(this),this.onTrainerTerminate=this.onTrainerTerminate.bind(this),this.onExitHyperParameterMenuClick=this.onExitHyperParameterMenuClick.bind(this),this.onStopTrainingClick=this.onStopTrainingClick.bind(this),this.onTestMenuExitClick=this.onTestMenuExitClick.bind(this),this.onExitViewMenuClick=this.onExitViewMenuClick.bind(this),this.onPreviousImageClick=this.onPreviousImageClick.bind(this),this.onNextImageClick=this.onNextImageClick.bind(this),this.onCustomImageInputChange=this.onCustomImageInputChange.bind(this),this.enterCropMenu=this.enterCropMenu.bind(this),this.onCropImageCanvasPointerDown=this.onCropImageCanvasPointerDown.bind(this),this.onCropImageCanvasPointerMove=this.onCropImageCanvasPointerMove.bind(this),this.onCropImageCanvasPointerUp=this.onCropImageCanvasPointerUp.bind(this),this.onShouldInvertInputChange=this.onShouldInvertInputChange.bind(this),this.onDarknessThresholdChange=this.onDarknessThresholdChange.bind(this),this.onCustomImageLabelInputValueChange=this.onCustomImageLabelInputValueChange.bind(this),this.onDeleteCustomImageClick=this.onDeleteCustomImageClick.bind(this),this.onAddCustomImageClick=this.onAddCustomImageClick.bind(this)}},{key:"componentDidMount",value:function(){var e=this;_.then((function(t){e.setState({mnist:f.option.some(t)})}),(function(t){var n={mnist:f.option.none(),stateType:te.MnistLoadingError,errorMessage:t.message};e.saveState(n)}))}},{key:"saveState",value:function(e){if(this.setState(e),"network"in e){var t=e.network;pe(t)}if("customImages"in e){var n=e.customImages;he(n)}}},{key:"render",value:function(){var e=this.state;switch(e.stateType){case te.CreateNetwork:return this.renderCreateNetworkMenu(e);case te.NetworkMainMenu:return this.renderNetworkMainMenu(e);case te.HyperParameterMenu:return this.renderHyperParameterMenu(e);case te.TrainingInProgress:return this.renderTrainingInProgressMenu(e);case te.Test:return this.renderTestMenu(e);case te.View:return this.renderViewMenu(e);case te.Crop:return this.renderCropMenu(e);case te.MnistLoadingError:return this.renderMnistLoadingErrorScreen(e)}}},{key:"renderCreateNetworkMenu",value:function(e){var t=this;return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,e.previousNetwork.match({none:function(){return"Create network"},some:function(){return"Reset network"}})),e.previousNetwork.match({none:function(){return null},some:function(e){return r.a.createElement("button",{onClick:function(){return t.cancelNetworkReset(e)}},"Cancel")}}),r.a.createElement("h2",null,"Layers:"),r.a.createElement("ol",null,r.a.createElement("li",null,"Input layer: 784 neurons",r.a.createElement("button",{onClick:function(){return t.addLayerBelow(0,e)}},"Add layer below")),e.hiddenLayerSizeInputValues.map((function(n,a){var i=a+1;return r.a.createElement("li",{key:i},r.a.createElement("label",null,"Hidden layer:"," ",r.a.createElement("input",{type:"text",className:we(n)?"":"InvalidInput",value:n,onChange:function(n){return t.changeLayerSizeValue(i,n.target.value,e)}})," ","neurons"),r.a.createElement("button",{onClick:function(){return t.addLayerBelow(i,e)}},"Add layer below"),r.a.createElement("button",{onClick:function(){return t.deleteLayer(i,e)}},"Delete layer"))})),r.a.createElement("li",null,"Output layer: 10 neurons")),r.a.createElement("label",null,"Weight initialization method:"," ",r.a.createElement("select",{value:e.weightInitializationMethod,onChange:this.onWeightInitializationMethodChange},r.a.createElement("option",{value:G.Uniform},"Uniform random on [-1, 1)"),r.a.createElement("option",{value:G.LargeGaussian},"Large Gaussian"),r.a.createElement("option",{value:G.SmallGaussian},"Small Gaussian"))),r.a.createElement("button",{onClick:this.onCreateNetworkClick,disabled:e.hiddenLayerSizeInputValues.some((function(e){return!we(e)}))},"Create network"))}},{key:"renderNetworkMainMenu",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Explore your neural network"),r.a.createElement("h2",null,"Neurons in each layer: ",e.network.layerSizes.join(", ")),r.a.createElement("button",{onClick:this.onTrainClick},"Train"),r.a.createElement("button",{onClick:this.onTestClick},"Test"),r.a.createElement("button",{onClick:this.onViewClick},"View"),r.a.createElement("button",{onClick:this.onResetClick},"Reset"))}},{key:"renderHyperParameterMenu",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Train (stochastic gradient descent)"),r.a.createElement("button",{onClick:this.onExitHyperParameterMenuClick},"Cancel"),r.a.createElement("h2",null,"Hyperparameters:"),r.a.createElement("label",null,"Batch size:"," ",r.a.createElement("input",{type:"text",className:we(e.batchSizeInputValue)?"":"InvalidInput",value:e.batchSizeInputValue,onChange:this.onBatchSizeInputValueChange})),r.a.createElement("label",null,"Epochs:"," ",r.a.createElement("input",{type:"text",className:we(e.epochsInputValue)?"":"InvalidInput",value:e.epochsInputValue,onChange:this.onEpochsInputValueChange})),r.a.createElement("label",null,"Learning rate:"," ",r.a.createElement("input",{type:"text",className:ye(e.learningRateInputValue)?"":"InvalidInput",value:e.learningRateInputValue,onChange:this.onLearningRateInputValueChange})),r.a.createElement("label",null,"Regularization rate:"," ",r.a.createElement("input",{type:"text",className:ye(e.regularizationRateInputValue)?"":"InvalidInput",value:e.regularizationRateInputValue,onChange:this.onRegularizationRateInputValueChange})),r.a.createElement("label",null,"Momentum coefficient:"," ",r.a.createElement("input",{type:"text",className:Ce(+e.momentumCoefficientInputValue)?"":"InvalidInput",value:e.momentumCoefficientInputValue,onChange:this.onMomentumCoefficientInputValueChange}),r.a.createElement("input",{type:"range",className:Ce(+e.momentumCoefficientInputValue)?"":"InvalidInput",min:0,max:1,step:.001,value:Number.isNaN(+e.momentumCoefficientInputValue)?0:+e.momentumCoefficientInputValue,onChange:this.onMomentumCoefficientInputValueChange})),r.a.createElement("button",{onClick:this.onStartTrainingClick,disabled:!(we(e.batchSizeInputValue)&&we(e.epochsInputValue)&&ye(e.learningRateInputValue)&&ye(e.regularizationRateInputValue)&&Ce(+e.momentumCoefficientInputValue))},"Start"))}},{key:"renderTrainingInProgressMenu",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Training in progress..."),r.a.createElement("h2",null,"Logs:"),e.epochAccuracyRates.slice().sort((function(e,t){return e.epoch-t.epoch})).map((function(e){return r.a.createElement("div",{key:e.epoch},"Epoch ",e.epoch,": ",e.correct," / ",e.total)})),r.a.createElement("button",{onClick:this.onStopTrainingClick},"Stop training after current epoch"))}},{key:"renderTestMenu",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Test results:"),e.accuracyRate.match({err:function(){return r.a.createElement("p",null,"Running tests...")},ok:function(e){return r.a.createElement("p",null,e.correct," / ",e.total," correct")}}),r.a.createElement("button",{onClick:this.onTestMenuExitClick},"Back"))}},{key:"renderViewMenu",value:function(e){var t=this;return e.mnist.match({none:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("p",null,"Loading..."))},some:function(n){var a=Ie(e,n),i=function(e,t){for(var n=e.performForwardPass(t).activations,a=n[n.length-1].rowMajorOrderEntries(),r=0,i=a[r],o=1;o<a.length;o++){var s=a[o];s>i&&(i=s,r=o)}return{digit:r,confidence:i}}(e.network,a.inputs);return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"View classifications"),r.a.createElement("button",{onClick:t.onExitViewMenuClick},"Back"),r.a.createElement("div",null,r.a.createElement("button",{onClick:t.onPreviousImageClick},"Previous")," ","Image ",e.viewedIndex+1," /"," ",n.test.length+e.customImages.length," ",r.a.createElement("button",{onClick:t.onNextImageClick},"Next")),r.a.createElement("canvas",{ref:t.viewImageCanvasRef}),r.a.createElement("div",{className:i.digit===a.label?"":"IncorrectGuess"},"Guess: ",i.digit," (",(100*i.confidence).toFixed(2),"% confident)"),r.a.createElement("div",null,"Actual: ",a.label),e.viewedIndex>=n.test.length&&r.a.createElement("div",null,r.a.createElement("button",{onClick:t.onDeleteCustomImageClick},"Delete this image")),r.a.createElement("div",null,r.a.createElement("label",null,"Upload your own image:"," ",r.a.createElement("input",{type:"file",accept:"image/*",ref:t.customImageInputRef,onChange:t.onCustomImageInputChange}))))}})}},{key:"renderCropMenu",value:function(e){return r.a.createElement("div",{className:"App",onMouseMove:this.onCropImageCanvasPointerMove,onTouchMove:this.onCropImageCanvasPointerMove,onMouseUp:this.onCropImageCanvasPointerUp,onTouchEnd:this.onCropImageCanvasPointerUp},r.a.createElement("h1",null,"Crop image"),r.a.createElement("div",null,r.a.createElement("canvas",{ref:this.cropImageCanvasRef,className:"CropImageCanvas WhiteBackground"+e.hoveredOverDraggable.match({none:function(){return""},some:function(e){switch(e){case ne.TopLeftCorner:case ne.BottomRightCorner:return" NwseResizeCursor";case ne.TopRightCorner:case ne.BottomLeftCorner:return" NeswResizeCursor";case ne.EntireSquare:return" MoveCursor"}}}),onMouseDown:this.onCropImageCanvasPointerDown,onTouchStart:this.onCropImageCanvasPointerDown})),r.a.createElement("div",null,r.a.createElement("label",null,"Invert"," ",r.a.createElement("input",{type:"checkbox",checked:e.shouldInvertImage,onChange:this.onShouldInvertInputChange}))),r.a.createElement("div",null,r.a.createElement("label",null,"Darkness threshold:"," ",r.a.createElement("input",{type:"range",value:e.darknessThreshold,min:0,max:1,step:.001,onChange:this.onDarknessThresholdChange}))),r.a.createElement("div",null,r.a.createElement("label",null,"Label:"," ",r.a.createElement("input",{type:"text",className:Te(e.labelInputValue)?"":"InvalidInput",value:e.labelInputValue,onChange:this.onCustomImageLabelInputValueChange}))),r.a.createElement("button",{disabled:!Te(e.labelInputValue),onClick:this.onAddCustomImageClick},"Add"))}},{key:"renderMnistLoadingErrorScreen",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Error loading MNIST data set:"),r.a.createElement("p",null,e.errorMessage))}},{key:"componentDidUpdate",value:function(){var e=this,t=this.state;t.mnist.ifSome((function(n){if(t.stateType===te.View){var a=e.viewImageCanvasRef.current;if(null!==a)!function(e,t){t.width=e.columns,t.height=e.rows;var n=t.getContext("2d"),a=function(e){for(var t=e.inputs.rowMajorOrderEntries(),n=new Uint8ClampedArray(4*t.length),a=0;a<t.length;a++){var r=255-Math.floor(255*t[a]);n[4*a]=r,n[4*a+1]=r,n[4*a+2]=r,n[4*a+3]=255}return new ImageData(n,e.columns,e.rows)}(e);n.putImageData(a,0,0)}(Ie(t,n),a)}else if(t.stateType===te.Crop){var r=e.cropImageCanvasRef.current;if(null!==r){var i=t.pendingCropAdjustment.match({none:function(){return t.cropSquare},some:function(e){return xe(t.cropSquare,e,r.width,r.height)}});be(t.uploadedImage,i,r,t.shouldInvertImage,t.darknessThreshold)}}}))}},{key:"cancelNetworkReset",value:function(e){var t={mnist:this.state.mnist,stateType:te.NetworkMainMenu,network:e};this.saveState(t)}},{key:"changeLayerSizeValue",value:function(e,t,n){this.saveState(Object(u.a)(Object(u.a)({},n),{},{hiddenLayerSizeInputValues:n.hiddenLayerSizeInputValues.map((function(n,a){return a+1===e?t:n}))}))}},{key:"addLayerBelow",value:function(e,t){this.saveState(Object(u.a)(Object(u.a)({},t),{},{hiddenLayerSizeInputValues:t.hiddenLayerSizeInputValues.slice(0,e).concat(["16"],t.hiddenLayerSizeInputValues.slice(e))}))}},{key:"deleteLayer",value:function(e,t){var n=e-1;this.saveState(Object(u.a)(Object(u.a)({},t),{},{hiddenLayerSizeInputValues:t.hiddenLayerSizeInputValues.slice(0,n).concat(t.hiddenLayerSizeInputValues.slice(n+1))}))}},{key:"onWeightInitializationMethodChange",value:function(e){var t=this.expectState(te.CreateNetwork),n=Object(u.a)(Object(u.a)({},t),{},{weightInitializationMethod:e.target.value});this.saveState(n)}},{key:"onCreateNetworkClick",value:function(){var e=this.expectState(te.CreateNetwork);if(e.hiddenLayerSizeInputValues.every(we)){var t=e.hiddenLayerSizeInputValues.map((function(e){return+e})),n=[784].concat(Object(s.a)(t),[10]),a={mnist:this.state.mnist,stateType:te.NetworkMainMenu,network:$.fromLayerSizes(n,e.weightInitializationMethod)};this.saveState(a)}}},{key:"expectState",value:function(e){var t=this.state;if(t.stateType===e)return t;throw new Error("Expecting a state of type "+te[e]+" but got state of type "+te[t.stateType])}},{key:"onTrainClick",value:function(){var e=this.expectState(te.NetworkMainMenu),t={mnist:e.mnist,stateType:te.HyperParameterMenu,network:e.network,batchSizeInputValue:"10",epochsInputValue:"30",learningRateInputValue:"0.5",regularizationRateInputValue:"5.0",momentumCoefficientInputValue:"0.0"};this.saveState(t)}},{key:"onTestClick",value:function(){var e=this,t=this.expectState(te.NetworkMainMenu),n=le(t.network,{onComplete:function(t){e.updateState(te.Test,{accuracyRate:f.result.ok(t)})}}),a={mnist:t.mnist,stateType:te.Test,network:t.network,accuracyRate:f.result.err(n)};this.saveState(a),n.start()}},{key:"updateState",value:function(e,t){var n=this.state;n.stateType===e&&("function"===typeof t?this.saveState(Object(u.a)(Object(u.a)({},n),t(n))):this.saveState(Object(u.a)(Object(u.a)({},n),t)))}},{key:"onViewClick",value:function(){var e=this.expectState(te.NetworkMainMenu),t={mnist:e.mnist,stateType:te.View,network:e.network,viewedIndex:0,customImages:ce().unwrapOr([])};this.saveState(t)}},{key:"onResetClick",value:function(){var e=this.expectState(te.NetworkMainMenu),t={mnist:e.mnist,stateType:te.CreateNetwork,hiddenLayerSizeInputValues:["30"],weightInitializationMethod:G.SmallGaussian,previousNetwork:f.option.some(e.network)};this.saveState(t)}},{key:"onBatchSizeInputValueChange",value:function(e){var t=this.expectState(te.HyperParameterMenu),n=Object(u.a)(Object(u.a)({},t),{},{batchSizeInputValue:e.target.value});this.saveState(n)}},{key:"onEpochsInputValueChange",value:function(e){var t=this.expectState(te.HyperParameterMenu),n=Object(u.a)(Object(u.a)({},t),{},{epochsInputValue:e.target.value});this.saveState(n)}},{key:"onLearningRateInputValueChange",value:function(e){var t=this.expectState(te.HyperParameterMenu),n=Object(u.a)(Object(u.a)({},t),{},{learningRateInputValue:e.target.value});this.saveState(n)}},{key:"onRegularizationRateInputValueChange",value:function(e){var t=this.expectState(te.HyperParameterMenu),n=Object(u.a)(Object(u.a)({},t),{},{regularizationRateInputValue:e.target.value});this.saveState(n)}},{key:"onMomentumCoefficientInputValueChange",value:function(e){var t=this.expectState(te.HyperParameterMenu),n=Object(u.a)(Object(u.a)({},t),{},{momentumCoefficientInputValue:e.target.value});this.saveState(n)}},{key:"onStartTrainingClick",value:function(){var e=this.expectState(te.HyperParameterMenu),t={batchSize:+e.batchSizeInputValue,epochs:+e.epochsInputValue,learningRate:+e.learningRateInputValue,regularizationRate:+e.regularizationRateInputValue,momentumCoefficient:+e.momentumCoefficientInputValue},n=ue(e.network,t,{onEpochComplete:this.onEpochComplete,onTerminate:this.onTrainerTerminate}),a={mnist:e.mnist,stateType:te.TrainingInProgress,network:e.network,networkTrainer:n,epochAccuracyRates:[]};this.saveState(a),n.start()}},{key:"onEpochComplete",value:function(e,t){this.updateState(te.TrainingInProgress,(function(n){return{epochAccuracyRates:n.epochAccuracyRates.concat([Object(u.a)(Object(u.a)({},e),{},{epoch:t})])}}))}},{key:"onTrainerTerminate",value:function(e){var t={mnist:this.expectState(te.TrainingInProgress).mnist,stateType:te.NetworkMainMenu,network:e};this.saveState(t)}},{key:"onExitHyperParameterMenuClick",value:function(){var e=this.expectState(te.HyperParameterMenu),t={mnist:e.mnist,stateType:te.NetworkMainMenu,network:e.network};this.saveState(t)}},{key:"onStopTrainingClick",value:function(){this.expectState(te.TrainingInProgress).networkTrainer.terminate()}},{key:"onTestMenuExitClick",value:function(){var e=this.expectState(te.Test);e.accuracyRate.ifErr((function(e){e.terminate()}));var t={mnist:e.mnist,stateType:te.NetworkMainMenu,network:e.network};this.saveState(t)}},{key:"onExitViewMenuClick",value:function(){var e=this.expectState(te.View),t={mnist:e.mnist,stateType:te.NetworkMainMenu,network:e.network};this.saveState(t)}},{key:"onPreviousImageClick",value:function(){var e=this,t=this.expectState(te.View);t.mnist.ifSome((function(n){var a=n.test.length+t.customImages.length,r=0===t.viewedIndex?a-1:t.viewedIndex-1;e.saveState(Object(u.a)(Object(u.a)({},t),{},{viewedIndex:r}))}))}},{key:"onNextImageClick",value:function(){var e=this,t=this.expectState(te.View);t.mnist.ifSome((function(n){var a=n.test.length+t.customImages.length,r=t.viewedIndex===a-1?0:t.viewedIndex+1;e.saveState(Object(u.a)(Object(u.a)({},t),{},{viewedIndex:r}))}))}},{key:"onCustomImageInputChange",value:function(){var e,t=this.customImageInputRef.current;null!==t&&null!==t.files&&t.files.length>0&&(e=t.files[0],function(e){return new Promise((function(t,n){var a=new FileReader;a.addEventListener("load",(function(){return t(a.result)})),a.addEventListener("error",(function(){return n(a.error)})),a.readAsDataURL(e)}))}(e).then((function(e){return new Promise((function(t,n){var a=document.createElement("img");a.src=e,a.addEventListener("load",(function(){return t(a)})),a.addEventListener("error",n)}))}))).then(this.enterCropMenu)}},{key:"enterCropMenu",value:function(e){var t=this.expectState(te.View),n={mnist:t.mnist,stateType:te.Crop,network:t.network,customImages:t.customImages,uploadedImage:e,darknessThreshold:Ve(e),cropSquare:{x:0,y:0,size:Math.min(e.width,e.height)},pendingCropAdjustment:f.option.none(),hoveredOverDraggable:f.option.none(),shouldInvertImage:!1,labelInputValue:""};this.saveState(n)}},{key:"onCropImageCanvasPointerDown",value:function(e){var t=this.expectState(te.Crop),n=t.cropSquare,a=this.cropImageCanvasRef.current,r=Se(e,a),i=r.x,o=r.y,s=a.getBoundingClientRect(),l=a.width/s.width,c=ke.GlobalCornerHandleRadius*l,h=Math.hypot(i-n.x,o-n.y)<=c?f.option.some(ne.TopLeftCorner):Math.hypot(i-(n.x+n.size),o-n.y)<=c?f.option.some(ne.TopRightCorner):Math.hypot(i-(n.x+n.size),o-(n.y+n.size))<=c?f.option.some(ne.BottomRightCorner):Math.hypot(i-n.x,o-(n.y+n.size))<=c?f.option.some(ne.BottomLeftCorner):i>n.x&&i<n.x+n.size&&o>n.y&&o<n.y+n.size?f.option.some(ne.EntireSquare):f.option.none();this.saveState(Object(u.a)(Object(u.a)({},t),{},{pendingCropAdjustment:h.map((function(e){return{dragged:e,startX:i,startY:o,currentX:i,currentY:o}}))}))}},{key:"onCropImageCanvasPointerMove",value:function(e){var t=this,n=this.expectState(te.Crop),a=this.cropImageCanvasRef.current,r=Se(e,a);n.pendingCropAdjustment.match({some:function(e){var i=Object(u.a)(Object(u.a)({},e),{},{currentX:r.x,currentY:r.y});t.saveState(Object(u.a)(Object(u.a)({},n),{},{pendingCropAdjustment:f.option.some(i)}));var o=xe(n.cropSquare,i,a.width,a.height);be(n.uploadedImage,o,a,n.shouldInvertImage,n.darknessThreshold)},none:function(){var e=a.getBoundingClientRect(),i=a.width/e.width,o=ke.GlobalCornerHandleRadius*i;t.saveState(Object(u.a)(Object(u.a)({},n),{},{hoveredOverDraggable:Ee(n.cropSquare,r.x,r.y,o)}))}})}},{key:"onCropImageCanvasPointerUp",value:function(){var e=this.expectState(te.Crop),t=this.cropImageCanvasRef.current,n=e.pendingCropAdjustment.match({none:function(){return e.cropSquare},some:function(n){return xe(e.cropSquare,n,t.width,t.height)}});this.saveState(Object(u.a)(Object(u.a)({},e),{},{pendingCropAdjustment:f.option.none(),cropSquare:n}))}},{key:"onShouldInvertInputChange",value:function(e){var t=this.expectState(te.Crop),n=Object(u.a)(Object(u.a)({},t),{},{shouldInvertImage:e.target.checked});this.saveState(n)}},{key:"onDarknessThresholdChange",value:function(e){var t=this.expectState(te.Crop),n=+e.target.value,a=Object(u.a)(Object(u.a)({},t),{},{darknessThreshold:n});this.saveState(a),be(t.uploadedImage,t.cropSquare,this.cropImageCanvasRef.current,t.shouldInvertImage,n)}},{key:"onCustomImageLabelInputValueChange",value:function(e){var t=this.expectState(te.Crop),n=Object(u.a)(Object(u.a)({},t),{},{labelInputValue:e.target.value});this.saveState(n)}},{key:"onAddCustomImageClick",value:function(){var e=this,t=this.expectState(te.Crop);Te(t.labelInputValue)&&t.mnist.ifSome((function(n){var a=+t.labelInputValue,r=function(e,t,n,a){var r=e.cropSquare,i=e.uploadedImage,o=document.createElement("canvas");o.width=28,o.height=28;var s=o.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(i,r.x,r.y,r.size,r.size,0,0,28,28),n&&Me(s);return function(e){var t=e.canvas,n=t.width,a=t.height,r=document.createElement("canvas");r.width=n,r.height=a;var i=r.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,n,a),i.drawImage(e.canvas,0,0);var o=i.getImageData(0,0,n,a);e.putImageData(o,0,0)}(s),{u8Matrix:Re(s.getImageData(0,0,28,28),a),label:t}}(t,a,t.shouldInvertImage,t.darknessThreshold),i=t.customImages.concat([r]),o=n.test.length+i.length-1,s={mnist:t.mnist,stateType:te.View,network:t.network,viewedIndex:o,customImages:i};e.saveState(s)}))}},{key:"onDeleteCustomImageClick",value:function(){var e=this,t=this.expectState(te.View);t.mnist.ifSome((function(n){var a=t.viewedIndex-n.test.length,r=t.customImages.slice(0,a).concat(t.customImages.slice(a+1)),i=Object(u.a)(Object(u.a)({},t),{},{customImages:r,viewedIndex:t.viewedIndex-1});e.saveState(i)}))}}]),n}(r.a.Component);function we(e){return Number.isFinite(+e)&&+e===Math.floor(+e)&&+e>0}function ye(e){return Number.isFinite(+e)&&+e>0}function Ce(e){return 0<=e&&e<=1}function Ie(e,t){return e.viewedIndex<t.test.length?t.test[e.viewedIndex]:{rows:28,columns:28,inputs:(n=e.customImages[e.viewedIndex-t.test.length]).u8Matrix.immutApplyElementwise((function(e){return e/255})),label:n.label};var n}var ke={OverlayColor:"#000a",CropSquareColor:"#08b",CropSquareLineWidth:3,GlobalCornerHandleRadius:10};function be(e,t,n,a,r){n.width=e.width,n.height=e.height;var i=n.getBoundingClientRect(),o=n.width/i.width,s=n.getContext("2d");return s.clearRect(0,0,n.width,n.height),s.drawImage(e,0,0),a&&Me(s),function(){var e=t.y+t.size,a=t.x+t.size;s.fillStyle=ke.OverlayColor,s.fillRect(0,0,n.width,t.y),s.fillRect(0,e,n.width,n.height-e),s.fillRect(0,t.y,t.x,t.size),s.fillRect(a,t.y,n.width-a,t.size)}(),function(){s.clearRect(t.x,t.y,t.size,t.size);var n=function(e,t,n,a){var r=document.createElement("canvas");r.width=28,r.height=28;var i=r.getContext("2d");i.drawImage(e,t.x,t.y,t.size,t.size,0,0,28,28),function(e){for(var t=e.getImageData(0,0,e.canvas.width,e.canvas.height),n=t.data,a=0;a<n.length;a+=4){var r=Math.floor((n[a]+n[a+1]+n[a+2])/3);n[a]=r,n[a+1]=r,n[a+2]=r}e.putImageData(t,0,0)}(i),n&&Me(i);return function(e,t){for(var n=1-t,a=e.getImageData(0,0,e.canvas.width,e.canvas.height),r=a.data,i=0;i<r.length;i+=4){var o=Math.floor((r[i]+r[i+1]+r[i+2])/3)/255<n?0:255;r[i]=o,r[i+1]=o,r[i+2]=o}e.putImageData(a,0,0)}(i,a),r}(e,t,a,r);s.imageSmoothingEnabled=!1,s.drawImage(n,t.x,t.y,t.size,t.size)}(),s.strokeStyle=ke.CropSquareColor,s.lineWidth=ke.CropSquareLineWidth,s.strokeRect(t.x,t.y,t.size,t.size),u(t.x,t.y),u(t.x+t.size,t.y),u(t.x+t.size,t.y+t.size),void u(t.x,t.y+t.size);function u(e,t){var n=ke.GlobalCornerHandleRadius*o;s.moveTo(e,t),s.beginPath(),s.arc(e,t,n,0,2*Math.PI),s.closePath(),s.fillStyle=ke.CropSquareColor,s.fill()}}function Se(e,t){var n=t.getBoundingClientRect(),a=function(e){return"clientX"in e?{x:e.clientX,y:e.clientY}:{x:e.touches[0].clientX,y:e.touches[0].clientY}}(e),r=a.x,i=a.y,o=t.width/n.width,s=t.height/n.height;return{x:o*(r-n.left),y:s*(i-n.top)}}function xe(e,t,n,a){return function(e,t,n,a){if(a){var r=e.x,i=e.y,o=e.size,s=t-o,u=n-o;return{x:Math.max(0,Math.min(r,s)),y:Math.max(0,Math.min(i,u)),size:o}}var l=e.x,c=e.y,h=e.size;l=Math.max(0,Math.min(l,t)),c=Math.max(0,Math.min(c,n));var m=Math.min(t-l,n-c);return h=Math.min(h,m),{x:l,y:c,size:h}}(function(e,t){if(function(e){return e.dragged!==ne.EntireSquare}(t))return function(e,t){switch(function(e){switch(e){case ne.TopLeftCorner:return ne.BottomRightCorner;case ne.TopRightCorner:return ne.BottomLeftCorner;case ne.BottomRightCorner:return ne.TopLeftCorner;case ne.BottomLeftCorner:return ne.TopRightCorner}}(t)){case ne.TopLeftCorner:return function(e){var t=e.x,n=e.y,a=e.width,r=e.height,i=Math.min(a,r);return{x:t,y:n,size:i}}(e);case ne.TopRightCorner:return function(e){var t=e.x,n=e.y,a=e.width,r=e.height,i=Math.min(a,r);return{x:a>r?t+a-i:t,y:n,size:i}}(e);case ne.BottomRightCorner:return function(e){var t=e.x,n=e.y,a=e.width,r=e.height,i=Math.min(a,r);return{x:a>r?t+a-i:t,y:r>a?n+r-i:n,size:i}}(e);case ne.BottomLeftCorner:return function(e){var t=e.x,n=e.y,a=e.width,r=e.height,i=Math.min(a,r);return{x:t,y:r>a?n+r-i:n,size:i}}(e)}}(function(e,t){var n=t.dragged,a=t.currentX,r=t.currentY,i=e.x,o=e.x+e.width,s=e.y,u=e.y+e.height;switch(n){case ne.TopLeftCorner:s=Math.min(r,u),i=Math.min(a,o);break;case ne.TopRightCorner:s=Math.min(r,u),o=Math.max(a,i);break;case ne.BottomRightCorner:u=Math.max(r,s),o=Math.max(a,i);break;case ne.BottomLeftCorner:u=Math.max(r,s),i=Math.min(a,o)}if(i>o){var l=[o,i];i=l[0],o=l[1]}if(s>u){var c=[u,s];s=c[0],u=c[1]}return{x:i,y:s,width:o-i,height:u-s}}({x:e.x,y:e.y,width:e.size,height:e.size},t),t.dragged);var n=t.currentX-t.startX,a=t.currentY-t.startY;return function(e,t,n){return{x:e.x+t,y:e.y+n,size:e.size}}(e,n,a)}(e,t),n,a,t.dragged===ne.EntireSquare)}function Ee(e,t,n,a){return Math.hypot(t-e.x,n-e.y)<=a?f.option.some(ne.TopLeftCorner):Math.hypot(t-(e.x+e.size),n-e.y)<=a?f.option.some(ne.TopRightCorner):Math.hypot(t-(e.x+e.size),n-(e.y+e.size))<=a?f.option.some(ne.BottomRightCorner):Math.hypot(t-e.x,n-(e.y+e.size))<=a?f.option.some(ne.BottomLeftCorner):t>e.x&&t<e.x+e.size&&n>e.y&&n<e.y+e.size?f.option.some(ne.EntireSquare):f.option.none()}function Me(e){for(var t=e.getImageData(0,0,e.canvas.width,e.canvas.height),n=t.data,a=0;a<n.length;a+=4)n[a]=255-n[a],n[a+1]=255-n[a+1],n[a+2]=255-n[a+2];e.putImageData(t,0,0)}function Te(e){return/^\d$/.test(e)}function Re(e,t){for(var n=1-t,a=e.data,r=new Array(a.length/4),i=0;i<a.length;i+=4){var o=255-(Math.floor((a[i]+a[i+1]+a[i+2])/3)/255<n?0:255);r[i/4]=o}return w.columnVector(r)}function Ve(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.fillStyle="#ffffff",n.fillRect(0,0,t.width,t.height),n.drawImage(e,0,0);for(var a=n.getImageData(0,0,t.width,t.height).data,r=0,i=0;i<a.length;i+=4){r+=Math.floor((a[i]+a[i+1]+a[i+2])/3)}var o=a.length/4;return(255-Math.floor(r/o))/255}n(34),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ve,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),window.networkFactory=$}},[[21,1,2]]]);
//# sourceMappingURL=main.ec80cb4c.chunk.js.map