(this["webpackJsonpmnist-digit-classifier-typescript"]=this["webpackJsonpmnist-digit-classifier-typescript"]||[]).push([[0],{16:function(e,t,n){e.exports=function(){return new Worker(n.p+"4c00d64cdaf85ce35dcf.worker.js")}},17:function(e,t,n){e.exports=function(){return new Worker(n.p+"b51bcd58d53903f8685a.worker.js")}},21:function(e,t,n){e.exports=n(35)},26:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(15),o=n.n(i),s=n(9),u=n(1),l=n(5),c=n(3),h=n(8),m=n(20),g=n(18),d=n(2),p=(n(26),n(19)),f=n(7),v=n.n(f),w=function(){function e(t,n,a){Object(l.a)(this,e),this.rows=void 0,this.columns=void 0,this.data=void 0,this.rows=t,this.columns=n,this.data=a}return Object(c.a)(e,null,[{key:"randomUniform",value:function(t,n){for(var a=t*n,r=new Array(a),i=0;i<a;i++)r[i]=2*Math.random()-1;return new e(t,n,r)}},{key:"zeros",value:function(t,n){return new e(t,n,new Array(t*n).fill(0))}},{key:"fromRows",value:function(t){var n=t[0].length;if(t.some((function(e){return e.length!==n})))throw new Error("Cannot create a matrix from a jagged array: "+JSON.stringify(t));return new e(t.length,n,t.flat())}},{key:"columnVector",value:function(t){return new e(t.length,1,t)}},{key:"fromRowMajorOrderEntries",value:function(t,n,a){if(a.length!==t*n)throw new Error("Expected "+t*n+" entries but instead got "+a.length+".");return new e(t,n,a)}}]),Object(c.a)(e,[{key:"clone",value:function(){return new e(this.rows,this.columns,this.data.slice())}},{key:"mutMultiplyScalar",value:function(e){for(var t=this.data.length,n=0;n<t;n++)this.data[n]*=e;return this}},{key:"mutAdd",value:function(e){if(e.rows!==this.rows||e.columns!==this.columns)throw new TypeError("Cannot add a "+this.rows+"x"+this.columns+" to a "+e.rows+"x"+e.columns+" matrix.");for(var t=this.data.length,n=0;n<t;n++)this.data[n]+=e.data[n];return this}},{key:"mutSubtract",value:function(e){if(e.rows!==this.rows||e.columns!==this.columns)throw new TypeError("Cannot add a "+this.rows+"x"+this.columns+" to a "+e.rows+"x"+e.columns+" matrix.");for(var t=this.data.length,n=0;n<t;n++)this.data[n]-=e.data[n];return this}},{key:"immutSubtract",value:function(e){if(e.rows!==this.rows||e.columns!==this.columns)throw new TypeError("Cannot add a "+this.rows+"x"+this.columns+" matrix to a "+e.rows+"x"+e.columns+" matrix.");for(var t=this.clone(),n=t.data.length,a=0;a<n;a++)t.data[a]-=e.data[a];return t}},{key:"immutMultiply",value:function(t){if(this.columns!==t.rows)throw new TypeError("Cannot multiply a "+this.rows+"x"+this.columns+" matrix with a "+t.rows+"x"+t.columns+" matrix.");for(var n=e.zeros(this.rows,t.columns),a=this.data,r=t.data,i=n.data,o=this.rows,s=t.columns,u=this.columns,l=n.columns,c=0;c<o;c++)for(var h=0;h<s;h++){for(var m=0,g=0;g<u;g++)m+=a[c*u+g]*r[g*s+h];i[c*l+h]=m}return n}},{key:"mutHadamard",value:function(e){if(e.rows!==this.rows||e.columns!==this.columns)throw new TypeError("Cannot take the Hadamard product of a "+this.rows+"x"+this.columns+" matrix and a "+e.rows+"x"+e.columns+" matrix.");for(var t=this.data.length,n=0;n<t;n++)this.data[n]*=e.data[n];return this}},{key:"immutTranspose",value:function(){for(var t=new e(this.columns,this.rows,this.data.slice()),n=0;n<this.rows;n++)for(var a=0;a<this.columns;a++)t.data[a*t.columns+n]=this.data[n*this.columns+a];return t}},{key:"rowMajorOrderEntries",value:function(){return this.data}},{key:"immutApplyElementwise",value:function(e){for(var t=this.clone(),n=t.data,a=n.length,r=0;r<a;r++)n[r]=e(n[r]);return t}},{key:"print",value:function(e){for(var t=this.rowMajorOrderEntries().map((function(t){return t.toFixed(e)})),n=t.map((function(e){return e.length})),a=Math.max.apply(Math,Object(s.a)(n)),r="-".repeat(this.columns*(a+" | ".length)-" | ".length),i=r+"\n",o=0;o<this.rows;o++){for(var u=0;u<this.columns;u++)i+=y(t[o*this.columns+u],a," ")+" | ";i=i.slice(0,-" | ".length),i+="\n"}return i+=r}}]),e}();function y(e,t,n){var a=t-e.length;return a<=0?e:n.repeat(a)+e}var C={offset:0,requiredValue:2051},k={offset:4},I={offset:8},b={offset:12},E={offset:0,requiredValue:2049},S={offset:4};function x(e,t){var n=function(e){var t=new Uint8Array(e);!function(e){var t=M(e,C.offset),n=C.requiredValue;if(t!==n)throw new Error("The first 4 bytes of an idx3 file must be 0x"+n.toString(16)+", but the first 4 bytes of the provided file were 0x"+t.toString(16))}(t);var n=M(t,k.offset),a=M(t,I.offset),r=M(t,b.offset),i=a*r,o=0,s=new Array(n),u=b.offset+4;for(;o<n;){for(var l=new Array(i),c=0;c<i;c++)l[c]=t[u+o*i+c]/255;s[o]={rows:a,columns:r,matrix:w.columnVector(l)},o++}return s}(e),a=function(e){var t=new Uint8Array(e);!function(e){var t=M(e,E.offset),n=E.requiredValue;if(t!==n)throw new Error("The first 4 bytes of an idx1 file must be 0x"+n.toString(16)+", but the first 4 bytes of the provided file were 0x"+t.toString(16))}(t);for(var n=M(t,S.offset),a=new Array(n),r=S.offset+4,i=0;i<n;i++)a[i]=t[r+i];return a}(t);if(n.length!==a.length)throw new Error("There are "+n.length+" images, but "+a.length+" labels. There must be the same amount of images and labels.");for(var r=new Array(n.length),i=0;i<n.length;i++){var o=n[i],s=o.rows,u=o.columns,l=o.matrix;r[i]={rows:s,columns:u,inputs:l,label:a[i]}}return r}function M(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function T(e){var t=new Array(10).fill(0);t[e.label]=1;var n=w.columnVector(t);return{rows:e.rows,columns:e.columns,inputs:e.inputs,outputs:n}}var R=self.location,z=v.a.resolve(R.href,"./assets/train60k-images-idx3-ubyte"),V=v.a.resolve(R.href,"./assets/train60k-labels-idx1-ubyte"),j=v.a.resolve(R.href,"./assets/test10k-images-idx3-ubyte"),N=v.a.resolve(R.href,"./assets/test10k-labels-idx1-ubyte"),O=B(z),A=B(V),L=B(j),P=B(N);function B(e){return fetch(e).then((function(t){return 200<=t.status&&t.status<=299?t.arrayBuffer():function(e){var t=e.status,n=e.statusText;return e.text().then((function(e){return t+" ("+n+"): "+e}))}(t).then((function(t){return Promise.reject(new Error("Tried to fetch "+e+" but got the following error: "+t))}))}))}var q=Promise.all([O,A,L,P]).then((function(e){var t=Object(p.a)(e,4),n=t[0],a=t[1],r=t[2],i=t[3];return{training:x(n,a).map(T),test:x(r,i)}})),D=n(10);function H(e,t){!function(e){for(var t=0;t<512;t++)for(var n=e.length-1;n>=1;n--){var a=(i=n+1,Math.floor(Math.random()*i)),r=e[n];e[n]=e[a],e[a]=r}var i}(e);for(var n=[],a=0;a<e.length;a+=t)n.push(e.slice(a,a+t));return n}function U(e){for(var t=0,n=e[t],a=1;a<e.length;a++){var r=e[a];r>n&&(n=r,t=a)}return t}var G=function(){function e(t,n){Object(l.a)(this,e),this.layers=void 0,this.weights=void 0,this.biases=void 0,this.log=void 0,this.sizes=void 0,this.layers=t.length,this.weights=[],this.biases=[];for(var a=1;a<t.length;a++){var r=a-1,i=t[a],o=t[r];this.weights[a]=w.randomUniform(i,o),this.biases[a]=w.randomUniform(i,1)}this.log=n||function(){},this.sizes=t}return Object(c.a)(e,null,[{key:"fromWeightsAndBiases",value:function(t,n){for(var a=[t[1].columns],r=1;r<t.length;r++)a.push(t[r].rows);for(var i=new e(a),o=1;o<t.length;o++)i.weights[o]=t[o],i.biases[o]=n[o];return i}}]),Object(c.a)(e,[{key:"stochasticGradientDescent",value:function(e,t,n){for(var a=t.batchSize,r=t.epochs,i=t.learningRate,o=e.length,s=0;s<r;s++){var u,l=H(e,a),c=Object(D.a)(l);try{for(c.s();!(u=c.n()).done;)for(var h=u.value,m=this.getAverageGradients(h,t.regularizationRate,o),g=m.weightGradients,d=m.biasGradients,p=1;p<this.layers;p++)g[p].mutMultiplyScalar(i),d[p].mutMultiplyScalar(i),this.weights[p].mutSubtract(g[p]),this.biases[p].mutSubtract(d[p])}catch(v){c.e(v)}finally{c.f()}if(void 0!==n){var f=this.test(n);this.log(f,s)}}}},{key:"getAverageGradients",value:function(e,t,n){var a,r=this.getZeroMatricesForWeightGradients(),i=this.getZeroMatricesForBiasGradients(),o=Object(D.a)(e);try{for(o.s();!(a=o.n()).done;)for(var s=a.value,u=this.getGradients(s,t,n),l=1;l<this.layers;l++)r[l].mutAdd(u.weightGradients[l]),i[l].mutAdd(u.biasGradients[l])}catch(h){o.e(h)}finally{o.f()}for(var c=1;c<this.layers;c++)r[c].mutMultiplyScalar(1/e.length),i[c].mutMultiplyScalar(1/e.length);return{weightGradients:r,biasGradients:i}}},{key:"getZeroMatricesForWeightGradients",value:function(){for(var e=[],t=1;t<this.layers;t++){var n=this.weights[t];e[t]=w.zeros(n.rows,n.columns)}return e}},{key:"getZeroMatricesForBiasGradients",value:function(){for(var e=[],t=1;t<this.layers;t++){var n=this.biases[t];e[t]=w.zeros(n.rows,n.columns)}return e}},{key:"getGradients",value:function(e,t,n){var a=this.performForwardPass(e.inputs),r=a.weightedSums,i=a.activations,o=[],s=[],u=[],l=this.getLastLayerError(i[this.layers-1],e.outputs);o[this.layers-1]=l,s[this.layers-1]=l.immutMultiply(i[this.layers-2].immutTranspose()).mutAdd(this.weights[this.layers-1].clone().mutMultiplyScalar(t/n)),u[this.layers-1]=l;for(var c=this.layers-2;c>=1;c--){var h=this.weights[c+1].immutTranspose().immutMultiply(o[c+1]);h.mutHadamard(r[c].immutApplyElementwise(W)),o[c]=h,s[c]=h.immutMultiply(i[c-1].immutTranspose()).mutAdd(this.weights[c].clone().mutMultiplyScalar(t/n)),u[c]=h}return{weightGradients:s,biasGradients:u}}},{key:"performForwardPass",value:function(e){for(var t=[],n=[e],a=1;a<this.layers;a++){var r=a-1,i=this.weights[a].immutMultiply(n[r]);i.mutAdd(this.biases[a]),t[a]=i,n[a]=i.immutApplyElementwise(F)}return{weightedSums:t,activations:n}}},{key:"getLastLayerError",value:function(e,t){return e.immutSubtract(t)}},{key:"test",value:function(e){var t,n=0,a=Object(D.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;U(this.performForwardPass(r.inputs).activations[this.layers-1].rowMajorOrderEntries())===r.label&&n++}}catch(i){a.e(i)}finally{a.f()}return{correct:n,total:e.length}}},{key:"getWeights",value:function(){return this.weights}},{key:"getBiases",value:function(){return this.biases}}]),e}();function F(e){return 1/(1+Math.exp(-e))}function W(e){var t=F(e);return t*(1-t)}var Y,X={fromSizes:function(e){return new G(e)},fromWeightsAndBiases:function(e,t){return G.fromWeightsAndBiases(e,t)}};function _(e){var t=function(e){for(var t=e.getWeights(),n=e.getBiases(),a=0,r=1;r<t.length;r++){var i=t[r],o=i.rows*i.columns;a+=o;var s=n[r],u=s.rows*s.columns;a+=u}for(var l=new Float64Array(a),c=0,h=1;h<t.length;h++){var m=t[h].rowMajorOrderEntries();l.set(m,c),c+=m.length;var g=n[h].rowMajorOrderEntries();l.set(g,c),c+=g.length}return l}(e),n=(1+e.sizes.length)*Uint32Array.BYTES_PER_ELEMENT,a=new ArrayBuffer(n+t.length*t.BYTES_PER_ELEMENT),r=new Uint32Array(a,0,n/Uint32Array.BYTES_PER_ELEMENT);r[0]=e.sizes.length;for(var i=0;i<e.sizes.length;i++)r[1+i]=e.sizes[i];return new Float64Array(a,n).set(t),a}function Z(e){for(var t=new Uint32Array(e,0,1)[0],n=new Uint32Array(e,4,t),a=new Float64Array(e.slice(Uint32Array.BYTES_PER_ELEMENT*(1+t))),r=[],i=[],o=0,s=1;s<n.length;s++){var u=n[s],l=u,c=n[s-1],h=l*c;r[s]=w.fromRowMajorOrderEntries(l,c,J(a.subarray(o,o+h))),o+=h;var m=u;i[s]=w.fromRowMajorOrderEntries(m,1,J(a.subarray(o,o+m))),o+=m}return X.fromWeightsAndBiases(r,i)}function J(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return t}!function(e){e[e.StartTrainingRequest=0]="StartTrainingRequest",e[e.TrainingEpochCompleteNotification=1]="TrainingEpochCompleteNotification",e[e.TerminateTrainingRequest=2]="TerminateTrainingRequest",e[e.TerminateTrainingResponse=3]="TerminateTrainingResponse",e[e.StartTestingRequest=4]="StartTestingRequest",e[e.TestCompleteNotification=5]="TestCompleteNotification"}(Y||(Y={}));var $,K,Q,ee=n(16),te=n.n(ee).a,ne=n(17),ae=n.n(ne).a;function re(e,t,n){var a=new ae;return a.addEventListener("message",(function(e){var t=e.data;if(null!==t&&"object"===typeof t&&"messageType"in t){var r=t;switch(r.messageType){case Y.TrainingEpochCompleteNotification:!function(e){n.onEpochComplete(e.accuracyRate,e.epoch)}(r);break;case Y.TerminateTrainingResponse:!function(e){var t=Z(e.networkBuffer);n.onTerminate(t),a.terminate()}(r);break;default:}}})),{start:function(){var n={messageType:Y.StartTrainingRequest,networkBuffer:_(e),hyperParams:t};a.postMessage(n,[n.networkBuffer])},terminate:function(){var e={messageType:Y.TerminateTrainingRequest};a.postMessage(e)}}}function ie(e,t){var n=new te;return n.addEventListener("message",(function(e){var a=e.data;null!==a&&"object"===typeof a&&"messageType"in a&&function(e){t.onComplete(e.accuracyRate),n.terminate()}(a)})),{start:function(){var t={messageType:Y.StartTestingRequest,networkBuffer:_(e)};n.postMessage(t,[t.networkBuffer])},terminate:function(){n.terminate()}}}!function(e){e[e.CreateNetwork=0]="CreateNetwork",e[e.NetworkMainMenu=1]="NetworkMainMenu",e[e.HyperParameterMenu=2]="HyperParameterMenu",e[e.TrainingInProgress=3]="TrainingInProgress",e[e.Test=4]="Test",e[e.View=5]="View",e[e.Crop=6]="Crop",e[e.MnistLoadingError=7]="MnistLoadingError"}($||($={})),function(e){e[e.TopLeftCorner=0]="TopLeftCorner",e[e.TopRightCorner=1]="TopRightCorner",e[e.BottomRightCorner=2]="BottomRightCorner",e[e.BottomLeftCorner=3]="BottomLeftCorner",e[e.EntireSquare=4]="EntireSquare"}(K||(K={})),function(e){e.CustomImages="CustomImages",e.NeuralNetwork="NeuralNetwork"}(Q||(Q={}));var oe=function(){var e=localStorage.getItem(Q.CustomImages);if(null===e)return d.option.none();var t=ce(e);if(t.length%785!==0)throw new Error("Cannot decode image bytes because there are "+t.length+" bytes, and that number is not a multiple of 784.");for(var n=t.length/785,a=new Array(n),r=0;r<n;r++){var i=t.subarray(785*r,785*r+784),o=w.columnVector(he(i));a[r]={u8Matrix:o,label:t[785*r+784]}}return d.option.some(a)},se=function(e){for(var t=new Uint8Array(785*e.length),n=0;n<e.length;n++){var a=e[n];t.set(a.u8Matrix.rowMajorOrderEntries(),785*n),t[785*n+784]=a.label}var r=me(t);localStorage.setItem(Q.CustomImages,r)},ue=function(){var e=localStorage.getItem(Q.NeuralNetwork);if(null===e)return d.option.none();var t=Z(ce(e).buffer);return d.option.some(t)},le=function(e){var t=_(e),n=me(new Uint8Array(t));localStorage.setItem(Q.NeuralNetwork,n)};function ce(e){for(var t=function(e){var t=new Uint32Array(1);return t[0]=e,t[0]}(e.charCodeAt(0)<<16|e.charCodeAt(1)),n=new Uint8Array(t),a=0;a<t;a++){var r=e.charCodeAt(2+Math.floor(a/2)),i=a%2===0?r>>>8:r;n[a]=i}return n}function he(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return t}function me(e){for(var t=e.length,n=new Array(Math.ceil(t/2)),a=0;a<e.length;a++){var r=e[a];a%2===0?n[a/2]=r<<8:n[(a-1)/2]|=r}return String.fromCharCode.apply(String,[t>>>16,65535&t].concat(n))}var ge=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).viewImageCanvasRef=void 0,a.customImageInputRef=void 0,a.cropImageCanvasRef=void 0,a.state=ue().match({none:function(){return{mnist:d.option.none(),stateType:$.CreateNetwork,hiddenLayerSizeInputValues:["30"],previousNetwork:d.option.none()}},some:function(e){return{mnist:d.option.none(),stateType:$.NetworkMainMenu,network:e}}}),a.viewImageCanvasRef=r.a.createRef(),a.customImageInputRef=r.a.createRef(),a.cropImageCanvasRef=r.a.createRef(),a.bindMethods(),window.app=Object(h.a)(a),a}return Object(c.a)(n,[{key:"bindMethods",value:function(){this.onCreateNetworkClick=this.onCreateNetworkClick.bind(this),this.onTrainClick=this.onTrainClick.bind(this),this.onTestClick=this.onTestClick.bind(this),this.onViewClick=this.onViewClick.bind(this),this.onResetClick=this.onResetClick.bind(this),this.onBatchSizeInputValueChange=this.onBatchSizeInputValueChange.bind(this),this.onEpochsInputValueChange=this.onEpochsInputValueChange.bind(this),this.onLearningRateInputValueChange=this.onLearningRateInputValueChange.bind(this),this.onRegularizationRateInputValueChange=this.onRegularizationRateInputValueChange.bind(this),this.onStartTrainingClick=this.onStartTrainingClick.bind(this),this.onEpochComplete=this.onEpochComplete.bind(this),this.onTrainerTerminate=this.onTrainerTerminate.bind(this),this.onExitHyperParameterMenuClick=this.onExitHyperParameterMenuClick.bind(this),this.onStopTrainingClick=this.onStopTrainingClick.bind(this),this.onTestMenuExitClick=this.onTestMenuExitClick.bind(this),this.onExitViewMenuClick=this.onExitViewMenuClick.bind(this),this.onPreviousImageClick=this.onPreviousImageClick.bind(this),this.onNextImageClick=this.onNextImageClick.bind(this),this.onCustomImageInputChange=this.onCustomImageInputChange.bind(this),this.enterCropMenu=this.enterCropMenu.bind(this),this.onCropImageCanvasPointerDown=this.onCropImageCanvasPointerDown.bind(this),this.onCropImageCanvasPointerMove=this.onCropImageCanvasPointerMove.bind(this),this.onCropImageCanvasPointerUp=this.onCropImageCanvasPointerUp.bind(this),this.onShouldInvertInputChange=this.onShouldInvertInputChange.bind(this),this.onDarknessThresholdChange=this.onDarknessThresholdChange.bind(this),this.onCustomImageLabelInputValueChange=this.onCustomImageLabelInputValueChange.bind(this),this.onDeleteCustomImageClick=this.onDeleteCustomImageClick.bind(this),this.onAddCustomImageClick=this.onAddCustomImageClick.bind(this)}},{key:"componentDidMount",value:function(){var e=this;q.then((function(t){e.setState({mnist:d.option.some(t)})}),(function(t){var n={mnist:d.option.none(),stateType:$.MnistLoadingError,errorMessage:t.message};e.saveState(n)}))}},{key:"saveState",value:function(e){if(this.setState(e),"network"in e){var t=e.network;le(t)}if("customImages"in e){var n=e.customImages;se(n)}}},{key:"render",value:function(){var e=this.state;switch(e.stateType){case $.CreateNetwork:return this.renderCreateNetworkMenu(e);case $.NetworkMainMenu:return this.renderNetworkMainMenu(e);case $.HyperParameterMenu:return this.renderHyperParameterMenu(e);case $.TrainingInProgress:return this.renderTrainingInProgressMenu(e);case $.Test:return this.renderTestMenu(e);case $.View:return this.renderViewMenu(e);case $.Crop:return this.renderCropMenu(e);case $.MnistLoadingError:return this.renderMnistLoadingErrorScreen(e)}}},{key:"renderCreateNetworkMenu",value:function(e){var t=this;return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,e.previousNetwork.match({none:function(){return"Create network"},some:function(){return"Reset network"}})),e.previousNetwork.match({none:function(){return null},some:function(e){return r.a.createElement("button",{onClick:function(){return t.cancelNetworkReset(e)}},"Cancel")}}),r.a.createElement("h2",null,"Layers:"),r.a.createElement("ol",null,r.a.createElement("li",null,"Input layer: 784 neurons",r.a.createElement("button",{onClick:function(){return t.addLayerBelow(0,e)}},"Add layer below")),e.hiddenLayerSizeInputValues.map((function(n,a){var i=a+1;return r.a.createElement("li",{key:i},r.a.createElement("label",null,"Hidden layer:"," ",r.a.createElement("input",{type:"text",className:de(n)?"":"InvalidInput",value:n,onChange:function(n){return t.changeLayerSizeValue(i,n.target.value,e)}})," ","neurons"),r.a.createElement("button",{onClick:function(){return t.addLayerBelow(i,e)}},"Add layer below"),r.a.createElement("button",{onClick:function(){return t.deleteLayer(i,e)}},"Delete layer"))})),r.a.createElement("li",null,"Output layer: 10 neurons")),r.a.createElement("button",{onClick:this.onCreateNetworkClick,disabled:e.hiddenLayerSizeInputValues.some((function(e){return!de(e)}))},"Create network"))}},{key:"renderNetworkMainMenu",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Explore your neural network"),r.a.createElement("h2",null,"Neurons in each layer: ",e.network.sizes.join(", ")),r.a.createElement("button",{onClick:this.onTrainClick},"Train"),r.a.createElement("button",{onClick:this.onTestClick},"Test"),r.a.createElement("button",{onClick:this.onViewClick},"View"),r.a.createElement("button",{onClick:this.onResetClick},"Reset"))}},{key:"renderHyperParameterMenu",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Train (stochastic gradient descent)"),r.a.createElement("button",{onClick:this.onExitHyperParameterMenuClick},"Cancel"),r.a.createElement("h2",null,"Hyperparameters:"),r.a.createElement("label",null,"Batch size:"," ",r.a.createElement("input",{type:"text",className:de(e.batchSizeInputValue)?"":"InvalidInput",value:e.batchSizeInputValue,onChange:this.onBatchSizeInputValueChange})),r.a.createElement("label",null,"Epochs:"," ",r.a.createElement("input",{type:"text",className:de(e.epochsInputValue)?"":"InvalidInput",value:e.epochsInputValue,onChange:this.onEpochsInputValueChange})),r.a.createElement("label",null,"Learning rate:"," ",r.a.createElement("input",{type:"text",className:pe(e.learningRateInputValue)?"":"InvalidInput",value:e.learningRateInputValue,onChange:this.onLearningRateInputValueChange})),r.a.createElement("label",null,"Regularization rate:"," ",r.a.createElement("input",{type:"text",className:pe(e.regularizationRateInputValue)?"":"InvalidInput",value:e.regularizationRateInputValue,onChange:this.onRegularizationRateInputValueChange})),r.a.createElement("button",{onClick:this.onStartTrainingClick,disabled:!(de(e.batchSizeInputValue)&&de(e.epochsInputValue)&&pe(e.learningRateInputValue)&&pe(e.regularizationRateInputValue))},"Start"))}},{key:"renderTrainingInProgressMenu",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Training in progress..."),r.a.createElement("h2",null,"Logs:"),e.epochAccuracyRates.slice().sort((function(e,t){return e.epoch-t.epoch})).map((function(e){return r.a.createElement("div",{key:e.epoch},"Epoch ",e.epoch,": ",e.correct," / ",e.total)})),r.a.createElement("button",{onClick:this.onStopTrainingClick},"Stop training after current epoch"))}},{key:"renderTestMenu",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Test results:"),e.accuracyRate.match({err:function(){return r.a.createElement("p",null,"Running tests...")},ok:function(e){return r.a.createElement("p",null,e.correct," / ",e.total," correct")}}),r.a.createElement("button",{onClick:this.onTestMenuExitClick},"Back"))}},{key:"renderViewMenu",value:function(e){var t=this;return e.mnist.match({none:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("p",null,"Loading..."))},some:function(n){var a=fe(e,n),i=function(e,t){for(var n=e.performForwardPass(t).activations,a=n[n.length-1].rowMajorOrderEntries(),r=0,i=a[r],o=1;o<a.length;o++){var s=a[o];s>i&&(i=s,r=o)}return{digit:r,confidence:i}}(e.network,a.inputs);return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"View classifications"),r.a.createElement("button",{onClick:t.onExitViewMenuClick},"Back"),r.a.createElement("div",null,r.a.createElement("button",{onClick:t.onPreviousImageClick},"Previous")," ","Image ",e.viewedIndex+1," /"," ",n.test.length+e.customImages.length," ",r.a.createElement("button",{onClick:t.onNextImageClick},"Next")),r.a.createElement("canvas",{ref:t.viewImageCanvasRef}),r.a.createElement("div",{className:i.digit===a.label?"":"IncorrectGuess"},"Guess: ",i.digit," (",(100*i.confidence).toFixed(2),"% confident)"),r.a.createElement("div",null,"Actual: ",a.label),e.viewedIndex>=n.test.length&&r.a.createElement("div",null,r.a.createElement("button",{onClick:t.onDeleteCustomImageClick},"Delete this image")),r.a.createElement("div",null,r.a.createElement("label",null,"Upload your own image:"," ",r.a.createElement("input",{type:"file",accept:"image/*",ref:t.customImageInputRef,onChange:t.onCustomImageInputChange}))))}})}},{key:"renderCropMenu",value:function(e){return r.a.createElement("div",{className:"App",onMouseMove:this.onCropImageCanvasPointerMove,onTouchMove:this.onCropImageCanvasPointerMove,onMouseUp:this.onCropImageCanvasPointerUp,onTouchEnd:this.onCropImageCanvasPointerUp},r.a.createElement("h1",null,"Crop image"),r.a.createElement("div",null,r.a.createElement("canvas",{ref:this.cropImageCanvasRef,className:"CropImageCanvas WhiteBackground"+e.hoveredOverDraggable.match({none:function(){return""},some:function(e){switch(e){case K.TopLeftCorner:case K.BottomRightCorner:return" NwseResizeCursor";case K.TopRightCorner:case K.BottomLeftCorner:return" NeswResizeCursor";case K.EntireSquare:return" MoveCursor"}}}),onMouseDown:this.onCropImageCanvasPointerDown,onTouchStart:this.onCropImageCanvasPointerDown})),r.a.createElement("div",null,r.a.createElement("label",null,"Invert"," ",r.a.createElement("input",{type:"checkbox",checked:e.shouldInvertImage,onChange:this.onShouldInvertInputChange}))),r.a.createElement("div",null,r.a.createElement("label",null,"Darkness threshold:"," ",r.a.createElement("input",{type:"range",value:e.darknessThreshold,min:0,max:1,step:.001,onChange:this.onDarknessThresholdChange}))),r.a.createElement("div",null,r.a.createElement("label",null,"Label:"," ",r.a.createElement("input",{type:"text",className:be(e.labelInputValue)?"":"InvalidInput",value:e.labelInputValue,onChange:this.onCustomImageLabelInputValueChange}))),r.a.createElement("button",{disabled:!be(e.labelInputValue),onClick:this.onAddCustomImageClick},"Add"))}},{key:"renderMnistLoadingErrorScreen",value:function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Error loading MNIST data set:"),r.a.createElement("p",null,e.errorMessage))}},{key:"componentDidUpdate",value:function(){var e=this,t=this.state;t.mnist.ifSome((function(n){if(t.stateType===$.View){var a=e.viewImageCanvasRef.current;if(null!==a)!function(e,t){t.width=e.columns,t.height=e.rows;var n=t.getContext("2d"),a=function(e){for(var t=e.inputs.rowMajorOrderEntries(),n=new Uint8ClampedArray(4*t.length),a=0;a<t.length;a++){var r=255-Math.floor(255*t[a]);n[4*a]=r,n[4*a+1]=r,n[4*a+2]=r,n[4*a+3]=255}return new ImageData(n,e.columns,e.rows)}(e);n.putImageData(a,0,0)}(fe(t,n),a)}else if(t.stateType===$.Crop){var r=e.cropImageCanvasRef.current;if(null!==r){var i=t.pendingCropAdjustment.match({none:function(){return t.cropSquare},some:function(e){return Ce(t.cropSquare,e,r.width,r.height)}});we(t.uploadedImage,i,r,t.shouldInvertImage,t.darknessThreshold)}}}))}},{key:"cancelNetworkReset",value:function(e){var t={mnist:this.state.mnist,stateType:$.NetworkMainMenu,network:e};this.saveState(t)}},{key:"changeLayerSizeValue",value:function(e,t,n){this.saveState(Object(u.a)(Object(u.a)({},n),{},{hiddenLayerSizeInputValues:n.hiddenLayerSizeInputValues.map((function(n,a){return a+1===e?t:n}))}))}},{key:"addLayerBelow",value:function(e,t){this.saveState(Object(u.a)(Object(u.a)({},t),{},{hiddenLayerSizeInputValues:t.hiddenLayerSizeInputValues.slice(0,e).concat(["16"],t.hiddenLayerSizeInputValues.slice(e))}))}},{key:"deleteLayer",value:function(e,t){var n=e-1;this.saveState(Object(u.a)(Object(u.a)({},t),{},{hiddenLayerSizeInputValues:t.hiddenLayerSizeInputValues.slice(0,n).concat(t.hiddenLayerSizeInputValues.slice(n+1))}))}},{key:"onCreateNetworkClick",value:function(){var e=this.expectState($.CreateNetwork);if(e.hiddenLayerSizeInputValues.every(de)){var t=e.hiddenLayerSizeInputValues.map((function(e){return+e})),n=[784].concat(Object(s.a)(t),[10]),a={mnist:this.state.mnist,stateType:$.NetworkMainMenu,network:X.fromSizes(n)};this.saveState(a)}}},{key:"expectState",value:function(e){var t=this.state;if(t.stateType===e)return t;throw new Error("Expecting a state of type "+$[e]+" but got state of type "+$[t.stateType])}},{key:"onTrainClick",value:function(){var e=this.expectState($.NetworkMainMenu),t={mnist:e.mnist,stateType:$.HyperParameterMenu,network:e.network,batchSizeInputValue:"10",epochsInputValue:"30",learningRateInputValue:"0.5",regularizationRateInputValue:"5.0"};this.saveState(t)}},{key:"onTestClick",value:function(){var e=this,t=this.expectState($.NetworkMainMenu),n=ie(t.network,{onComplete:function(t){e.updateState($.Test,{accuracyRate:d.result.ok(t)})}}),a={mnist:t.mnist,stateType:$.Test,network:t.network,accuracyRate:d.result.err(n)};this.saveState(a),n.start()}},{key:"updateState",value:function(e,t){var n=this.state;n.stateType===e&&("function"===typeof t?this.saveState(Object(u.a)(Object(u.a)({},n),t(n))):this.saveState(Object(u.a)(Object(u.a)({},n),t)))}},{key:"onViewClick",value:function(){var e=this.expectState($.NetworkMainMenu),t={mnist:e.mnist,stateType:$.View,network:e.network,viewedIndex:0,customImages:oe().unwrapOr([])};this.saveState(t)}},{key:"onResetClick",value:function(){var e=this.expectState($.NetworkMainMenu),t={mnist:e.mnist,stateType:$.CreateNetwork,hiddenLayerSizeInputValues:["30"],previousNetwork:d.option.some(e.network)};this.saveState(t)}},{key:"onBatchSizeInputValueChange",value:function(e){var t=this.expectState($.HyperParameterMenu),n=Object(u.a)(Object(u.a)({},t),{},{batchSizeInputValue:e.target.value});this.saveState(n)}},{key:"onEpochsInputValueChange",value:function(e){var t=this.expectState($.HyperParameterMenu),n=Object(u.a)(Object(u.a)({},t),{},{epochsInputValue:e.target.value});this.saveState(n)}},{key:"onLearningRateInputValueChange",value:function(e){var t=this.expectState($.HyperParameterMenu),n=Object(u.a)(Object(u.a)({},t),{},{learningRateInputValue:e.target.value});this.saveState(n)}},{key:"onRegularizationRateInputValueChange",value:function(e){var t=this.expectState($.HyperParameterMenu),n=Object(u.a)(Object(u.a)({},t),{},{regularizationRateInputValue:e.target.value});this.saveState(n)}},{key:"onStartTrainingClick",value:function(){var e=this.expectState($.HyperParameterMenu),t={batchSize:+e.batchSizeInputValue,epochs:+e.epochsInputValue,learningRate:+e.learningRateInputValue,regularizationRate:+e.regularizationRateInputValue},n=re(e.network,t,{onEpochComplete:this.onEpochComplete,onTerminate:this.onTrainerTerminate}),a={mnist:e.mnist,stateType:$.TrainingInProgress,network:e.network,networkTrainer:n,epochAccuracyRates:[]};this.saveState(a),n.start()}},{key:"onEpochComplete",value:function(e,t){this.updateState($.TrainingInProgress,(function(n){return{epochAccuracyRates:n.epochAccuracyRates.concat([Object(u.a)(Object(u.a)({},e),{},{epoch:t})])}}))}},{key:"onTrainerTerminate",value:function(e){var t={mnist:this.expectState($.TrainingInProgress).mnist,stateType:$.NetworkMainMenu,network:e};this.saveState(t)}},{key:"onExitHyperParameterMenuClick",value:function(){var e=this.expectState($.HyperParameterMenu),t={mnist:e.mnist,stateType:$.NetworkMainMenu,network:e.network};this.saveState(t)}},{key:"onStopTrainingClick",value:function(){this.expectState($.TrainingInProgress).networkTrainer.terminate()}},{key:"onTestMenuExitClick",value:function(){var e=this.expectState($.Test);e.accuracyRate.ifErr((function(e){e.terminate()}));var t={mnist:e.mnist,stateType:$.NetworkMainMenu,network:e.network};this.saveState(t)}},{key:"onExitViewMenuClick",value:function(){var e=this.expectState($.View),t={mnist:e.mnist,stateType:$.NetworkMainMenu,network:e.network};this.saveState(t)}},{key:"onPreviousImageClick",value:function(){var e=this,t=this.expectState($.View);t.mnist.ifSome((function(n){var a=n.test.length+t.customImages.length,r=0===t.viewedIndex?a-1:t.viewedIndex-1;e.saveState(Object(u.a)(Object(u.a)({},t),{},{viewedIndex:r}))}))}},{key:"onNextImageClick",value:function(){var e=this,t=this.expectState($.View);t.mnist.ifSome((function(n){var a=n.test.length+t.customImages.length,r=t.viewedIndex===a-1?0:t.viewedIndex+1;e.saveState(Object(u.a)(Object(u.a)({},t),{},{viewedIndex:r}))}))}},{key:"onCustomImageInputChange",value:function(){var e,t=this.customImageInputRef.current;null!==t&&null!==t.files&&t.files.length>0&&(e=t.files[0],function(e){return new Promise((function(t,n){var a=new FileReader;a.addEventListener("load",(function(){return t(a.result)})),a.addEventListener("error",(function(){return n(a.error)})),a.readAsDataURL(e)}))}(e).then((function(e){return new Promise((function(t,n){var a=document.createElement("img");a.src=e,a.addEventListener("load",(function(){return t(a)})),a.addEventListener("error",n)}))}))).then(this.enterCropMenu)}},{key:"enterCropMenu",value:function(e){var t=this.expectState($.View),n={mnist:t.mnist,stateType:$.Crop,network:t.network,customImages:t.customImages,uploadedImage:e,darknessThreshold:Se(e),cropSquare:{x:0,y:0,size:Math.min(e.width,e.height)},pendingCropAdjustment:d.option.none(),hoveredOverDraggable:d.option.none(),shouldInvertImage:!1,labelInputValue:""};this.saveState(n)}},{key:"onCropImageCanvasPointerDown",value:function(e){var t=this.expectState($.Crop),n=t.cropSquare,a=this.cropImageCanvasRef.current,r=ye(e,a),i=r.x,o=r.y,s=a.getBoundingClientRect(),l=a.width/s.width,c=ve.GlobalCornerHandleRadius*l,h=Math.hypot(i-n.x,o-n.y)<=c?d.option.some(K.TopLeftCorner):Math.hypot(i-(n.x+n.size),o-n.y)<=c?d.option.some(K.TopRightCorner):Math.hypot(i-(n.x+n.size),o-(n.y+n.size))<=c?d.option.some(K.BottomRightCorner):Math.hypot(i-n.x,o-(n.y+n.size))<=c?d.option.some(K.BottomLeftCorner):i>n.x&&i<n.x+n.size&&o>n.y&&o<n.y+n.size?d.option.some(K.EntireSquare):d.option.none();this.saveState(Object(u.a)(Object(u.a)({},t),{},{pendingCropAdjustment:h.map((function(e){return{dragged:e,startX:i,startY:o,currentX:i,currentY:o}}))}))}},{key:"onCropImageCanvasPointerMove",value:function(e){var t=this,n=this.expectState($.Crop),a=this.cropImageCanvasRef.current,r=ye(e,a);n.pendingCropAdjustment.match({some:function(e){var i=Object(u.a)(Object(u.a)({},e),{},{currentX:r.x,currentY:r.y});t.saveState(Object(u.a)(Object(u.a)({},n),{},{pendingCropAdjustment:d.option.some(i)}));var o=Ce(n.cropSquare,i,a.width,a.height);we(n.uploadedImage,o,a,n.shouldInvertImage,n.darknessThreshold)},none:function(){var e=a.getBoundingClientRect(),i=a.width/e.width,o=ve.GlobalCornerHandleRadius*i;t.saveState(Object(u.a)(Object(u.a)({},n),{},{hoveredOverDraggable:ke(n.cropSquare,r.x,r.y,o)}))}})}},{key:"onCropImageCanvasPointerUp",value:function(){var e=this.expectState($.Crop),t=this.cropImageCanvasRef.current,n=e.pendingCropAdjustment.match({none:function(){return e.cropSquare},some:function(n){return Ce(e.cropSquare,n,t.width,t.height)}});this.saveState(Object(u.a)(Object(u.a)({},e),{},{pendingCropAdjustment:d.option.none(),cropSquare:n}))}},{key:"onShouldInvertInputChange",value:function(e){var t=this.expectState($.Crop),n=Object(u.a)(Object(u.a)({},t),{},{shouldInvertImage:e.target.checked});this.saveState(n)}},{key:"onDarknessThresholdChange",value:function(e){var t=this.expectState($.Crop),n=+e.target.value,a=Object(u.a)(Object(u.a)({},t),{},{darknessThreshold:n});this.saveState(a),we(t.uploadedImage,t.cropSquare,this.cropImageCanvasRef.current,t.shouldInvertImage,n)}},{key:"onCustomImageLabelInputValueChange",value:function(e){var t=this.expectState($.Crop),n=Object(u.a)(Object(u.a)({},t),{},{labelInputValue:e.target.value});this.saveState(n)}},{key:"onAddCustomImageClick",value:function(){var e=this,t=this.expectState($.Crop);be(t.labelInputValue)&&t.mnist.ifSome((function(n){var a=+t.labelInputValue,r=function(e,t,n,a){var r=e.cropSquare,i=e.uploadedImage,o=document.createElement("canvas");o.width=28,o.height=28;var s=o.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(i,r.x,r.y,r.size,r.size,0,0,28,28),n&&Ie(s);return function(e){var t=e.canvas,n=t.width,a=t.height,r=document.createElement("canvas");r.width=n,r.height=a;var i=r.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,n,a),i.drawImage(e.canvas,0,0);var o=i.getImageData(0,0,n,a);e.putImageData(o,0,0)}(s),{u8Matrix:Ee(s.getImageData(0,0,28,28),a),label:t}}(t,a,t.shouldInvertImage,t.darknessThreshold),i=t.customImages.concat([r]),o=n.test.length+i.length-1,s={mnist:t.mnist,stateType:$.View,network:t.network,viewedIndex:o,customImages:i};e.saveState(s)}))}},{key:"onDeleteCustomImageClick",value:function(){var e=this,t=this.expectState($.View);t.mnist.ifSome((function(n){var a=t.viewedIndex-n.test.length,r=t.customImages.slice(0,a).concat(t.customImages.slice(a+1)),i=Object(u.a)(Object(u.a)({},t),{},{customImages:r,viewedIndex:t.viewedIndex-1});e.saveState(i)}))}}]),n}(r.a.Component);function de(e){return Number.isFinite(+e)&&+e===Math.floor(+e)&&+e>0}function pe(e){return Number.isFinite(+e)&&+e>0}function fe(e,t){return e.viewedIndex<t.test.length?t.test[e.viewedIndex]:{rows:28,columns:28,inputs:(n=e.customImages[e.viewedIndex-t.test.length]).u8Matrix.immutApplyElementwise((function(e){return e/255})),label:n.label};var n}var ve={OverlayColor:"#000a",CropSquareColor:"#08b",CropSquareLineWidth:3,GlobalCornerHandleRadius:10};function we(e,t,n,a,r){n.width=e.width,n.height=e.height;var i=n.getBoundingClientRect(),o=n.width/i.width,s=n.getContext("2d");return s.clearRect(0,0,n.width,n.height),s.drawImage(e,0,0),a&&Ie(s),function(){var e=t.y+t.size,a=t.x+t.size;s.fillStyle=ve.OverlayColor,s.fillRect(0,0,n.width,t.y),s.fillRect(0,e,n.width,n.height-e),s.fillRect(0,t.y,t.x,t.size),s.fillRect(a,t.y,n.width-a,t.size)}(),function(){s.clearRect(t.x,t.y,t.size,t.size);var n=function(e,t,n,a){var r=document.createElement("canvas");r.width=28,r.height=28;var i=r.getContext("2d");i.drawImage(e,t.x,t.y,t.size,t.size,0,0,28,28),function(e){for(var t=e.getImageData(0,0,e.canvas.width,e.canvas.height),n=t.data,a=0;a<n.length;a+=4){var r=Math.floor((n[a]+n[a+1]+n[a+2])/3);n[a]=r,n[a+1]=r,n[a+2]=r}e.putImageData(t,0,0)}(i),n&&Ie(i);return function(e,t){for(var n=1-t,a=e.getImageData(0,0,e.canvas.width,e.canvas.height),r=a.data,i=0;i<r.length;i+=4){var o=Math.floor((r[i]+r[i+1]+r[i+2])/3)/255<n?0:255;r[i]=o,r[i+1]=o,r[i+2]=o}e.putImageData(a,0,0)}(i,a),r}(e,t,a,r);s.imageSmoothingEnabled=!1,s.drawImage(n,t.x,t.y,t.size,t.size)}(),s.strokeStyle=ve.CropSquareColor,s.lineWidth=ve.CropSquareLineWidth,s.strokeRect(t.x,t.y,t.size,t.size),u(t.x,t.y),u(t.x+t.size,t.y),u(t.x+t.size,t.y+t.size),void u(t.x,t.y+t.size);function u(e,t){var n=ve.GlobalCornerHandleRadius*o;s.moveTo(e,t),s.beginPath(),s.arc(e,t,n,0,2*Math.PI),s.closePath(),s.fillStyle=ve.CropSquareColor,s.fill()}}function ye(e,t){var n=t.getBoundingClientRect(),a=function(e){return"clientX"in e?{x:e.clientX,y:e.clientY}:{x:e.touches[0].clientX,y:e.touches[0].clientY}}(e),r=a.x,i=a.y,o=t.width/n.width,s=t.height/n.height;return{x:o*(r-n.left),y:s*(i-n.top)}}function Ce(e,t,n,a){return function(e,t,n,a){if(a){var r=e.x,i=e.y,o=e.size,s=t-o,u=n-o;return{x:Math.max(0,Math.min(r,s)),y:Math.max(0,Math.min(i,u)),size:o}}var l=e.x,c=e.y,h=e.size;l=Math.max(0,Math.min(l,t)),c=Math.max(0,Math.min(c,n));var m=Math.min(t-l,n-c);return h=Math.min(h,m),{x:l,y:c,size:h}}(function(e,t){if(function(e){return e.dragged!==K.EntireSquare}(t))return function(e,t){switch(function(e){switch(e){case K.TopLeftCorner:return K.BottomRightCorner;case K.TopRightCorner:return K.BottomLeftCorner;case K.BottomRightCorner:return K.TopLeftCorner;case K.BottomLeftCorner:return K.TopRightCorner}}(t)){case K.TopLeftCorner:return function(e){var t=e.x,n=e.y,a=e.width,r=e.height,i=Math.min(a,r);return{x:t,y:n,size:i}}(e);case K.TopRightCorner:return function(e){var t=e.x,n=e.y,a=e.width,r=e.height,i=Math.min(a,r);return{x:a>r?t+a-i:t,y:n,size:i}}(e);case K.BottomRightCorner:return function(e){var t=e.x,n=e.y,a=e.width,r=e.height,i=Math.min(a,r);return{x:a>r?t+a-i:t,y:r>a?n+r-i:n,size:i}}(e);case K.BottomLeftCorner:return function(e){var t=e.x,n=e.y,a=e.width,r=e.height,i=Math.min(a,r);return{x:t,y:r>a?n+r-i:n,size:i}}(e)}}(function(e,t){var n=t.dragged,a=t.currentX,r=t.currentY,i=e.x,o=e.x+e.width,s=e.y,u=e.y+e.height;switch(n){case K.TopLeftCorner:s=Math.min(r,u),i=Math.min(a,o);break;case K.TopRightCorner:s=Math.min(r,u),o=Math.max(a,i);break;case K.BottomRightCorner:u=Math.max(r,s),o=Math.max(a,i);break;case K.BottomLeftCorner:u=Math.max(r,s),i=Math.min(a,o)}if(i>o){var l=[o,i];i=l[0],o=l[1]}if(s>u){var c=[u,s];s=c[0],u=c[1]}return{x:i,y:s,width:o-i,height:u-s}}({x:e.x,y:e.y,width:e.size,height:e.size},t),t.dragged);var n=t.currentX-t.startX,a=t.currentY-t.startY;return function(e,t,n){return{x:e.x+t,y:e.y+n,size:e.size}}(e,n,a)}(e,t),n,a,t.dragged===K.EntireSquare)}function ke(e,t,n,a){return Math.hypot(t-e.x,n-e.y)<=a?d.option.some(K.TopLeftCorner):Math.hypot(t-(e.x+e.size),n-e.y)<=a?d.option.some(K.TopRightCorner):Math.hypot(t-(e.x+e.size),n-(e.y+e.size))<=a?d.option.some(K.BottomRightCorner):Math.hypot(t-e.x,n-(e.y+e.size))<=a?d.option.some(K.BottomLeftCorner):t>e.x&&t<e.x+e.size&&n>e.y&&n<e.y+e.size?d.option.some(K.EntireSquare):d.option.none()}function Ie(e){for(var t=e.getImageData(0,0,e.canvas.width,e.canvas.height),n=t.data,a=0;a<n.length;a+=4)n[a]=255-n[a],n[a+1]=255-n[a+1],n[a+2]=255-n[a+2];e.putImageData(t,0,0)}function be(e){return/^\d$/.test(e)}function Ee(e,t){for(var n=1-t,a=e.data,r=new Array(a.length/4),i=0;i<a.length;i+=4){var o=255-(Math.floor((a[i]+a[i+1]+a[i+2])/3)/255<n?0:255);r[i/4]=o}return w.columnVector(r)}function Se(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.fillStyle="#ffffff",n.fillRect(0,0,t.width,t.height),n.drawImage(e,0,0);for(var a=n.getImageData(0,0,t.width,t.height).data,r=0,i=0;i<a.length;i+=4){r+=Math.floor((a[i]+a[i+1]+a[i+2])/3)}var o=a.length/4;return(255-Math.floor(r/o))/255}n(34),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ge,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),window.networkFactory=X}},[[21,1,2]]]);
//# sourceMappingURL=main.8edeb5f4.chunk.js.map